<!DOCTYPE html>

<html>

<head lang="en">
    <meta charset="utf-8" />
    <!--Page Title-->
    <title>
        Culinaviz </title>
    <!--Meta Keywords and Description-->
    <meta content="" name="keywords" />
    <meta content="" name="description" />
    <meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport" />
    <!--Favicon-->
    <link href="images/favicon.ico" rel="shortcut icon" title="Favicon" />
    <!-- Main CSS Files -->
    <link href="css/style.css" rel="stylesheet" />
    <!-- Namari Color CSS -->
    <link href="css/namari-color.css" rel="stylesheet" />
    <!-- Add custom CSS file -->
    <link href="css/custom.css" rel="stylesheet" />
    <!--Icon Fonts - Font Awesome Icons-->
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <!-- Animate CSS-->
    <link href="css/animate.css" rel="stylesheet" type="text/css" />
    <!--Google Webfonts-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800" rel="stylesheet"
        type="text/css" />
    <style>
        body {
            margin: 0;
            background-color: white;
            font-family: 'Open Sans', sans-serif;
            padding: 20px;
        }

        .section-heading {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-heading h3 {
            font-size: 18px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .section-heading h2 {
            font-size: 28px;
            margin: 0 0 10px;
            color: #333;
        }

        .section-heading p {
            color: #666;
            font-size: 16px;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        #bubble-container {
            flex-grow: 1;
            border-radius: 4px;
            background: #fff;
            position: relative;
            height: calc(100vh - 320px);
            /* Increased space for visualization */
            max-height: 650px;
            /* Slightly increased from 600px */
            width: 100%;
            max-width: 700px;
            /* Slightly increased from 650px */
            margin: 0 auto;
            padding: 25px;
            /* Adjusted from 30px for better proportion */
        }

        #bubble-container>svg {
            display: block;
        }

        #tooltip {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 8px 10px;
            border-radius: 3px;
            font-size: 11px;
            font-family: 'Open Sans', sans-serif;
            pointer-events: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: opacity 0.3s ease;
            max-width: 200px;
            line-height: 1.4;
            opacity: 0;
            border: 1px solid #eee;
            z-index: 9999;
        }

        .label {
            font-family: 'Open Sans', sans-serif;
            text-anchor: middle;
            pointer-events: none;
            fill: #444;
            font-weight: 600;
        }

        .node {
            stroke: #fff;
            stroke-width: 1.5px;
            transition: stroke-width 0.3s ease;
        }

        .node:hover {
            stroke-width: 2.5px;
        }

        /* Bubble Chart Visualization Styles */
        .visualization-container {
            display: flex;
            flex-direction: row;
            max-width: 700px;
            width: 75%;
            margin: 0 auto;
            overflow: visible !important;
            /* Force overflow visible */
            align-items: flex-start;
            padding-left: 0;
            padding-right: 400px;
            /* Increased padding to match new legend position */
            /* Add padding to accommodate legend */
            background-color: transparent;
            position: relative;
            height: calc(100vh - 280px);
            min-height: 500px;
        }

        #legend-container {
            position: absolute;
            top: 20px;
            right: -380px;
            background: white;
            padding: 18px;
            border-radius: 8px;
            color: #333;
            font-size: 11px;
            z-index: 10;
            max-width: 180px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.12);
            font-family: 'Open Sans', sans-serif;
        }

        .legend-title {
            font-size: 13px;
            margin: 0 0 12px 0;
            color: #111;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            font-weight: 600;
            letter-spacing: 0.2px;
        }

        .legend-section {
            margin-bottom: 22px;
            padding: 0 0 5px 0;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            border: none;
        }

        .legend-section:last-child {
            margin-bottom: 0;
        }

        .legend-subtitle {
            font-size: 12px;
            margin: 0 0 10px 0;
            color: #333;
            font-weight: 600;
            border-left: 3px solid #C62828;
            padding-left: 8px;
            letter-spacing: 0.1px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .bubble-type-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            padding: 2px;
        }

        .bubble-type-item:last-child {
            margin-bottom: 0;
        }

        .bubble-sample {
            width: 8px;
            height: 8px;
            min-width: 8px;
            margin-right: 6px;
            border-radius: 50%;
            background: #f8f8f8;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .bubble-sample.category {
            border: 1px solid #333;
        }

        .bubble-sample.ingredient {
            border: 1px dashed #333;
        }

        .bubble-label {
            font-size: 10px;
            color: #666;
            line-height: 1;
        }

        /* Region Colors Section */
        .color-sample {
            width: 10px;
            height: 10px;
            min-width: 10px;
            margin-right: 8px;
            border-radius: 2px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .region-label {
            font-size: 11px;
            color: #444;
            line-height: 1.2;
        }

        .border-sample {
            width: 12px;
            height: 12px;
            margin-right: 4px;
        }

        .border-solid {
            border: 2px solid #333;
        }

        .border-dashed {
            border: 2px dashed #333;
        }

        .border-thick {
            border-width: 1.8px;
        }

        .border-thin {
            border-width: 1px;
        }

        .legend-item:hover {
            background: #f9f9f9;
        }

        .color-box {
            width: 22px;
            height: 22px;
            margin-right: 12px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #tooltip strong {
            color: #111;
            font-size: 12px;
        }

        /* End of Bubble Chart Styles */

        #bubble-viz #legend-container {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            /* Was 15px */
            border-radius: 5px;
            /* Was 8px */
            color: #333;
            font-size: 12px;
            /* Was 14px */
            z-index: 10;
            max-width: 150px;
            /* Was 180px */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            /* Was 0 4px 12px rgba(0,0,0,0.15) */
            font-family: 'Open Sans', sans-serif;
        }

        #bubble-viz .bubble-label,
        #bubble-viz .region-label {
            font-size: 10px;
            color: #444;
            line-height: 1.2;
            white-space: nowrap;
            /* Added */
            overflow: hidden;
            /* Added */
            text-overflow: ellipsis;
            /* Added */
        }

        /* Hide category text labels in the radial chart visualization (only inside the nodes, not in legend) */
        #radial-chart g text[dy="0.35em"][text-anchor="middle"][font-size="12px"] {
            display: none !important;
        }

        /* Additional specific selector to hide text labels inside the nodes */
        #radial-chart g>circle+text:not(.emoji-label) {
            display: none !important;
        }

        /* Keep emoji labels visible and make them larger */
        #radial-chart g text.emoji-label {
            display: inline !important;
            font-size: 24px !important;
        }

        /* Extra CSS to force-hide all other text in the SVG */
        #radial-chart text:not(.emoji-label),
        #radial-chart g text:not([class="emoji-label"]) {
            display: none !important;
        }

        /* Force correct emoji display */
        #radial-chart text.emoji-label {
            display: inline !important;
            font-size: 24px !important;
        }

        /* Responsive adjustments for Team Section */
        @media (max-width: 992px) {
            #team-section .team-members-container {
                gap: 32px;
                /* Reduced gap for medium screens */
            }
        }

        /* Removing sphere styles */
        .sphere {
            fill: #000000;
            /* Black ocean */
        }

        .graticule {
            fill: none;
            stroke: #000000;
            /* Alterado para preto, combinando com os contornos dos pa√≠ses */
            stroke-width: 0.3px;
            stroke-opacity: 0.8;
            /* Aumentado de 0.6 para 0.8 para melhor visibilidade */
        }

        .boundary {
            fill: none;
            stroke: #000000;
            /* Alterado para contornos pretos */
            stroke-width: 0.6px;
            /* A bit thicker for visibility */
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* Estilos modernos para mapa e visualiza√ß√µes */
        .tooltip-map {
            /* Base styles for when not active - these are mostly for fallback or direct class use */
            position: fixed;
            /* Changed from absolute for better cross-context behavior */
            background: rgba(40, 40, 40, 0.9);
            color: #fff;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            /* High z-index */
            display: none;
            /* Initially hidden */
        }

        .tooltip-map.active {
            opacity: 1 !important;
            /* Ensure it overrides inline if necessary */
            transform: scale(1) !important;
            display: block !important;
            visibility: visible !important;
            /* Ensure it's visible */
            /* backdrop-filter: blur(8px); /* Keep if you like this effect */
            /* -webkit-backdrop-filter: blur(8px); */
            /* background: rgba(40, 40, 40, 0.85); /* Already set in .tooltip-map */
            /* border: 1px solid rgba(255, 255, 255, 0.1); */
        }

        /* Estilos refinados para itens da legenda */
        .legend-item {
            cursor: pointer;
            margin: 3px 0;
            padding: 7px 10px;
            border-radius: 6px;
            transition: all 0.25s cubic-bezier(0.165, 0.84, 0.44, 1);
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #333;
            background: rgba(255, 255, 255, 0.5);
            border-left: 3px solid transparent;
        }

        .legend-item:hover {
            background-color: #f0f4f8;
            transform: translateX(2px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            border-left-color: #e74c3c;
        }

        .legend-item.inactive {
            opacity: 0.65;
            filter: grayscale(40%);
        }

        .legend-item.inactive:hover {
            opacity: 0.8;
            background-color: #f0f4f8;
        }

        .legend-color {
            display: inline-block;
            width: 14px;
            height: 14px;
            margin-right: 8px;
            vertical-align: middle;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .legend-group {
            margin-bottom: 14px;
        }

        .legend-group-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            padding-bottom: 4px;
            border-bottom: 2px solid #f0f0f0;
            color: #333;
            letter-spacing: 0.5px;
        }

        /* Estiliza√ß√£o moderna para o controle deslizante de ano */
        input[type="range"] {
            height: 30px;
            -webkit-appearance: none;
            margin: 10px 0;
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            position: relative;
            z-index: 5;
            cursor: pointer;
        }

        input[type="range"]:focus {
            outline: none;
            border: none;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            animate: 0.2s;
            background: linear-gradient(to right, rgba(231, 76, 60, 0.3), rgba(231, 76, 60, 0.9));
            border-radius: 0;
            box-shadow: none;
            border: none;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            /* Standard property */
            height: 20px;
            /* Still need some size for interaction */
            width: 20px;
            margin-top: -7px;
            /* Adjust to center on a 6px high track, if track height changes adjust this */
            background: transparent;
            /* Make default thumb invisible */
            border: transparent;
            /* Ensure border is also invisible */
            box-shadow: none;
            cursor: pointer;
            border-radius: 50%;
            /* Can make it round even if invisible, just in case */
            transition: transform 0.2s ease;
        }

        input[type="range"]::-moz-range-thumb {
            /* Firefox */
            height: 20px;
            width: 20px;
            background: transparent;
            border: transparent;
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="range"]::-ms-thumb {
            /* IE/Edge */
            height: 20px;
            width: 20px;
            background: transparent;
            border: transparent;
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 6px rgba(231, 76, 60, 0.6);
        }

        input[type="range"]:active::-webkit-slider-thumb {
            transform: scale(1.15);
            box-shadow: 0 3px 8px rgba(231, 76, 60, 0.7);
        }

        /* Estiliza√ß√£o dos bot√µes */
        #playPauseBtn {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            margin-right: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 6px rgba(231, 76, 60, 0.18);
            transition: all 0.2s ease;
        }

        #playPauseBtn i {
            font-size: 14px !important;
        }

        #playPauseBtn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.4);
        }

        #playPauseBtn:active {
            transform: scale(0.98);
        }

        #resetBtn {
            background: #f8f8f8;
            color: #333;
            border: none;
            border-radius: 0;
            padding: 8px 16px;
            margin-left: 15px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            flex-shrink: 0;
            box-shadow: none;
            transition: all 0.2s ease;
        }

        #resetBtn:hover {
            background: #ebebeb;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        /* Estiliza√ß√£o da se√ß√£o de tipos de cozinha */
        #legend {
            background: #ffffff;
            padding: 22px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
        }

        #legend h3 {
            margin-top: 0;
            margin-bottom: 18px;
            font-size: 20px;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 12px;
            letter-spacing: 0.5px;
        }

        /* Melhorias no mapa e containers */
        #map {
            width: 100%;
            height: 600px;
            display: block;
            background-color: #ffffff;
            border: none;
            /* Removed border */
            border-radius: 10px;
            /* Kept border-radius for consistency if needed elsewhere */
            box-shadow: none;
            /* Removed inner shadow */
        }

        .tick-marks {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
        }

        .tick-marks span {
            font-size: 12px;
            font-weight: 500;
            color: #555;
        }

        /* Visualiza√ß√£o dos n√≥s do gr√°fico de bolhas */
        .node {
            transition: all 0.3s ease;
        }

        .node:hover {
            filter: brightness(1.05);
        }

        #tooltip-map {
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            position: absolute;
            background: rgba(40, 40, 40, 0.9);
            color: #fff;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.95);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 9999;
        }

        /* Tooltip for the map */
        #tooltip-map {
            position: fixed;
            /* Use fixed for consistent positioning relative to viewport */
            background: rgba(40, 40, 40, 0.9);
            color: #fff;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 13px;
            pointer-events: none;
            /* Allows clicks to pass through to map elements */
            opacity: 0;
            /* Start hidden */
            transform: scale(0.95);
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            /* Ensure it's above other elements, increased from 9999 */
            display: none;
            /* Start hidden */
        }

        #tooltip-map.active {
            opacity: 1;
            transform: scale(1);
            display: block;
            /* Show when active */
            visibility: visible;
        }

        /* Tooltip for the map - updated for light theme */
        #tooltip-map.tooltip {
            position: fixed;
            background: rgba(255, 255, 255, 0.98);
            color: #333;
            padding: 10px 15px;
            /* Adjusted padding slightly from bubble chart's 12px 15px */
            border-radius: 6px;
            font-size: 13px;
            /* Consistent with previous map tooltip */
            font-family: 'Open Sans', sans-serif;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            z-index: 10000;
            display: none;
            max-width: 280px;
            /* From bubble chart tooltip */
            line-height: 1.5em;
            /* From bubble chart tooltip */
            border: none;
            /* From bubble chart tooltip */
        }

        #tooltip-map.tooltip.active {
            opacity: 1;
            transform: scale(1);
            display: block;
            visibility: visible;
        }

        #tooltip-map.tooltip strong {
            color: #111;
            /* For strong tags within this tooltip */
            font-weight: 600;
        }

        /* Estilos da legenda removidos e substitu√≠dos pela vers√£o atualizada abaixo */

        #bubble-viz .border-solid-bubble {
            border: 2px solid #333;
        }

        #bubble-viz .border-dashed-bubble {
            border: 2px dashed #333;
        }

        #bubble-viz .border-thick-bubble {
            border-width: 1.8px;
        }

        #bubble-viz .border-thin-bubble {
            border-width: 1px;
        }

        #bubble-viz #bubble-container-chart {
            /* Renamed */
            flex-grow: 1;
            /* width: 900px; /* Let it be responsive */
            height: 750px;
            /* Adjusted height */
            display: flex;
            justify-content: center;
            align-items: center;
            /* margin-left: 30px; /* Adjusted */
            position: relative;
        }

        #bubble-viz #tooltip-bubble {
            /* Renamed */
            position: absolute;
            background: rgba(255, 255, 255, 0.98);
            color: #333;
            padding: 12px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Open Sans', sans-serif;
            pointer-events: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            max-width: 280px;
            line-height: 1.5em;
            opacity: 0;
            border: none;
            z-index: 9999;
        }

        #bubble-viz #tooltip-bubble strong {
            color: #111;
            font-weight: 600;
        }

        #bubble-viz .label-bubble {
            /* Renamed */
            font-family: 'Open Sans', sans-serif;
            text-anchor: middle;
            pointer-events: none;
            fill: white;
            font-weight: 600;
        }

        #bubble-viz .node-bubble {
            /* Renamed */
            stroke: #fff;
            stroke-width: 1.5px;
        }

        #bubble-viz #legend-container-bubble {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 220px;
            min-width: 220px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 6px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(0, 0, 0, 0.05);
            z-index: 100;
            font-size: 12px;
            font-family: 'Open Sans', sans-serif;
            pointer-events: auto;
        }

        #bubble-viz .legend-title-bubble {
            margin-top: 0;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 6px;
        }

        #bubble-viz .legend-section-bubble {
            margin-bottom: 12px;
        }

        #bubble-viz .legend-subtitle-bubble {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #555;
            padding-left: 5px;
            border-left: 2px solid #ddd;
        }

        #bubble-viz .legend-item-bubble {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            padding: 2px 3px;
            border-radius: 3px;
        }

        #bubble-viz .legend-item-bubble:hover {
            background: rgba(0, 0, 0, 0.03);
        }

        #bubble-viz .color-box-bubble {
            width: 15px;
            height: 15px;
            margin-right: 7px;
            border-radius: 3px;
        }

        #bubble-viz .border-sample-bubble {
            width: 20px;
            height: 20px;
            margin-right: 7px;
            border-radius: 50%;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .custom-slider {
            width: 100%;
            height: 16px;
            background: transparent;
            border: none;
            outline: none;
            position: relative;
            margin: 0;
            padding: 0;
        }

        .custom-slider::-webkit-slider-runnable-track {
            width: 100%;
            height: 16px;
            background: #e0e0e0;
            border-radius: 8px;
            position: relative;
        }

        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
            border: 3px solid #e74c3c;
            margin-top: -6px;
            cursor: pointer;
            transition: box-shadow 0.2s;
        }

        .custom-slider:focus::-webkit-slider-thumb {
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.25);
        }

        .custom-slider::-ms-fill-lower {
            background: #e74c3c;
            border-radius: 8px;
        }

        .custom-slider::-ms-fill-upper {
            background: #e0e0e0;
            border-radius: 8px;
        }

        .custom-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
            border: 3px solid #e74c3c;
            cursor: pointer;
        }

        .custom-slider::-moz-range-track {
            width: 100%;
            height: 16px;
            background: #e0e0e0;
            border-radius: 8px;
        }

        .custom-slider::-ms-thumb {
            width: 28px;
            height: 28px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
            border: 3px solid #e74c3c;
            cursor: pointer;
        }

        .custom-slider:focus {
            outline: none;
        }

        .custom-slider::-ms-tooltip {
            display: none;
        }

        .custom-slider:focus::-ms-fill-lower {
            background: #e74c3c;
        }

        .custom-slider:focus::-ms-fill-upper {
            background: #e0e0e0;
        }

        .custom-slider::-webkit-slider-thumb:hover {
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.25);
        }

        .custom-slider::-webkit-slider-thumb:active {
            box-shadow: 0 6px 16px rgba(231, 76, 60, 0.35);
        }

        .custom-slider::-moz-focus-outer {
            border: 0;
        }

        .custom-slider::-webkit-slider-thumb {
            z-index: 2;
            position: relative;
        }

        .custom-slider::-webkit-slider-runnable-track {
            z-index: 1;
        }

        .custom-slider-progress {
            position: absolute;
            height: 16px;
            background: #e74c3c;
            border-radius: 8px;
            top: 0;
            left: 0;
            z-index: 1;
            pointer-events: none;
        }

        input[type="range"].custom-slider {
            width: 100%;
            height: 16px;
            background: transparent;
            border: none;
            outline: none;
            margin: 0;
            padding: 0;
        }

        input[type="range"].custom-slider::-webkit-slider-runnable-track {
            width: 100%;
            height: 16px;
            background: #e74c3c;
            border-radius: 8px;
        }

        input[type="range"].custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
            border: 3px solid #e74c3c;
            margin-top: -6px;
            cursor: pointer;
            transition: box-shadow 0.2s;
            position: relative;
            z-index: 2;
        }

        input[type="range"].custom-slider:focus::-webkit-slider-thumb {
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.25);
        }

        input[type="range"].custom-slider::-ms-fill-lower {
            background: #e74c3c;
            border-radius: 8px;
        }

        input[type="range"].custom-slider::-ms-fill-upper {
            background: #e74c3c;
            border-radius: 8px;
        }

        input[type="range"].custom-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
            border: 3px solid #e74c3c;
            cursor: pointer;
        }

        input[type="range"].custom-slider::-moz-range-track {
            width: 100%;
            height: 16px;
            background: #e74c3c;
            border-radius: 8px;
        }

        input[type="range"].custom-slider::-ms-thumb {
            width: 28px;
            height: 28px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
            border: 3px solid #e74c3c;
            cursor: pointer;
        }

        input[type="range"].custom-slider:focus {
            outline: none;
        }

        input[type="range"].custom-slider::-ms-tooltip {
            display: none;
        }

        input[type="range"].custom-slider:focus::-ms-fill-lower {
            background: #e74c3c;
        }

        input[type="range"].custom-slider:focus::-ms-fill-upper {
            background: #e74c3c;
        }

        input[type="range"].custom-slider::-webkit-slider-thumb:hover {
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.25);
        }

        input[type="range"].custom-slider::-webkit-slider-thumb:active {
            box-shadow: 0 6px 16px rgba(231, 76, 60, 0.35);
        }

        input[type="range"].custom-slider::-moz-focus-outer {
            border: 0;
        }
    </style>
</head>

<body>
    <!-- Preloader -->
    <div id="preloader">
        <div class="la-ball-triangle-path" id="status">
            <div>
            </div>
            <div>
            </div>
            <div>
            </div>
        </div>
    </div>
    <!--End of Preloader-->
    <div class="page-border" data-wow-delay="0.2s" data-wow-duration="0.7s">
        <div class="top-border wow fadeInDown animated" style="visibility: visible; animation-name: fadeInDown;">
        </div>
        <div class="right-border wow fadeInRight animated" style="visibility: visible; animation-name: fadeInRight;">
        </div>
        <div class="bottom-border wow fadeInUp animated" style="visibility: visible; animation-name: fadeInUp;">
        </div>
        <div class="left-border wow fadeInLeft animated" style="visibility: visible; animation-name: fadeInLeft;">
        </div>
    </div>
    <div id="wrapper">
        <header class="scrollto clearfix" data-enllax-ratio=".5" id="banner">
            <div class="nav-collapse" id="header">
                <div class="row clearfix">
                    <div class="col-1">
                        <!--Logo-->
                        <div id="logo">
                            <!--Logo that is shown on the banner-->
                            <img alt="Landing Page" id="banner-logo" src="images/logo.png" />
                            <!--End of Banner Logo-->
                            <!--The Logo that is shown on the sticky Navigation Bar-->
                            <img alt="Landing Page" id="navigation-logo" src="images/logo-2.png" />
                            <!--End of Navigation Logo-->
                        </div>
                        <!--End of Logo-->
                        <aside>
                            <!--Social Icons in Header-->
                            <!--End of Social Icons in Header-->
                        </aside>
                        <!--Main Navigation-->
                        <nav id="nav-main">
                            <ul>
                                <li><a href="#banner">Home</a></li>
                                <li><a href="#about">About</a></li>
                                <li><a href="#interactive-map-section">Restaurants Map</a></li>
                                <li><a href="#globe-section">Globe Map</a></li>
                                <li><a href="#bubble-viz">Ingredient Hierarchy</a></li>
                                <li><a href="#radial-chart-section">Cuisine Connections</a></li>
                                <li><a href="#team-section">Team</a></li>
                            </ul>
                        </nav>
                        <!--End of Main Navigation-->
                        <div id="nav-trigger">
                            <span>
                            </span>
                        </div>
                        <nav id="nav-mobile">
                            <ul>
                                <li><a href="#banner">Home</a></li>
                                <li><a href="#about">About</a></li>
                                <li><a href="#globe-section">Globe Map</a></li>
                                <li><a href="#bubble-viz">Ingredient Hierarchy</a></li>
                                <li><a href="#interactive-map-section">Restaurants Map</a></li>
                                <li><a href="#radial-chart-section">Cuisine Connections</a></li>
                                <li><a href="#team-section">Team</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            <!--End of Header-->
            <!--Banner Content-->
            <div class="row clearfix" id="banner-content">
                <div class="col-38">
                    <section id="chart">

                        <div class="section-heading" style="text-align: left;">
                            <h1>
                                EXPLORE GLOBAL CUISINE
                            </h1>
                            <h2>
                                Discover ingredient relationships from around the world with interactive visualizations.
                            </h2>
                        </div>
                        <!--Call to Action-->
                        <a class="button" href="#globe-section">
                            EXPLORE <i class="fa fa-chart-pie"></i>
                        </a>
                        <!--End Call to Action-->
                </div>
                </section>
            </div>
        </header>
        <main id="content">
            <!--Content Section-->
            <div class="scrollto clearfix" id="about">
                <div class="row no-padding-bottom clearfix">
                    <!--Content Left Side-->
                    <div class="col-3">
                        <!--User Testimonial-->
                        <blockquote class="testimonial text-right bigtest">
                            <q>
                                Food is a common subject on social media, which makes it possible to study the
                                relationship
                                between geography and health in new ways. The combination of crowd-sourced data and
                                advanced
                                computational techniques will continue to have strong impact on food science and
                                gastronomy.
                            </q>
                            <footer>
                                ‚Äî Yong-Yeol Ahn, Data Scientist & Food Visualization Researcher
                            </footer>
                        </blockquote>
                        <!-- End of Testimonial-->
                    </div>
                    <!--End Content Left Side-->
                    <!--Content of the Right Side-->
                    <div class="col-3">
                        <div class="section-heading">
                            <h3>
                                VISUALIZATION
                            </h3>
                            <h2 class="section-title">
                                Exploring the Flavours of the World
                            </h2>
                            <p class="section-subtitle">
                                Uncover hidden connections between ingredients, recipes, and cultures through
                                interactive data visualizations.
                            </p>
                        </div>
                        <p>
                            From a global recipe map to ingredient categories and their subtle links, this project
                            reveals culinary patterns in a clear, elegant, and engaging way. Our visualizations
                            transform complex culinary data into accessible insights about how we cook and eat across
                            cultures.
                        </p>
                        <p>
                            A visual journey through world cuisine, powered by real data and intuitive design. Explore
                            how ingredients connect across regions and discover the fascinating relationships that
                            define global food traditions.
                        </p>
                        <!-- Change video button to a link to the Globe Map section -->
                        <a class="button" href="#globe-section">
                            EXPLORE VISUALIZATIONS
                            <i aria-hidden="true" class="fa fa-chart-bar">
                            </i>
                        </a>
                    </div>
                    <!--End Content Right Side-->
                    <div class="col-3">
                        <img alt="Data Visualization" src="images/dancer.jpg" />
                    </div>
                </div>
            </div>
            <!--End of Content Section-->
            <section id="interactive-map-section" class="scrollto clearfix"
                style="background:#fff; padding:60px 0 80px 0; margin-bottom: 40px;">
                <div class="row clearfix">
                    <div class="section-heading"
                        style="text-align: center; max-width: 900px; margin: 0 auto 30px auto;">
                        <h3 style="color:#888">EXPLORE</h3>
                        <h2 class="section-title">World's Best Restaurants Interactive Map</h2>
                        <p class="section-subtitle">Explore the global distribution of the world's finest restaurants
                            over time. Filter by
                            cuisine type or click on countries to focus on specific regions.</p>
                    </div>

                    <div
                        style="display: flex; width: 100%; max-width: 1200px; margin: 0 auto; gap: 0; flex-direction: column; align-items: center; position: relative;">
                        <!-- Timeline control acima do mapa, agora centralizado -->
                        <div
                            style="max-width: 500px; width: 100%; margin: 0 auto 30px auto; background: transparent; padding: 0; text-align: center;">
                            <!-- Year display above slider -->
                            <h3
                                style="margin: 0 0 10px 0; font-size: 18px; font-weight: 500; color: #333; text-align: center;">
                                Year: <span id="yearDisplay" style="font-weight:600; color:#e74c3c;">2015</span>
                            </h3>

                            <!-- Slider and controls on same line, perfeitamente alinhados -->
                            <div style="display: flex; align-items: center; justify-content: center; margin-top: 5px;">
                                <button id="playPauseBtn" class="play-btn"
                                    style="width:30px; height:30px; margin-right:12px; border-radius:50%; background: linear-gradient(145deg, #e74c3c, #c0392b); border:none; color:white; cursor:pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; align-self: center; margin-top: 4px;">
                                    <i class="fa fa-play" style="font-size:12px;"></i>
                                </button>

                                <div
                                    style="flex-grow: 1; position: relative; padding: 0 6px; display: flex; flex-direction: column;">
                                    <input type="range" id="yearSlider" min="2002" max="2023" value="2015" step="1"
                                        class="custom-slider">
                                    <div class="tick-marks"
                                        style="display: flex; justify-content: space-between; margin-top: 4px; padding: 0 2px;">
                                        <span
                                            style="font-size: 11px; color: #666; flex: 1; text-align: left;">2002</span>
                                        <span
                                            style="font-size: 11px; color: #666; flex: 1; text-align: center;">2007</span>
                                        <span
                                            style="font-size: 11px; color: #666; flex: 1; text-align: center;">2012</span>
                                        <span
                                            style="font-size: 11px; color: #666; flex: 1; text-align: center;">2017</span>
                                        <span
                                            style="font-size: 11px; color: #666; flex: 1; text-align: right;">2023</span>
                                    </div>
                                </div>

                                <button id="resetBtn"
                                    style="margin-left:12px; padding:6px 12px; font-size:13px; border-radius:6px; border:1px solid #ddd; background:#fff; color:#666; cursor:pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); align-self: center; margin-top: 4px;">Reset</button>
                            </div>
                        </div>

                        <div
                            style="display: flex; width: 100%; justify-content: center; align-items: center; gap: 80px; position: relative;">
                            <!-- Coluna do mapa (centralizada) -->
                            <div
                                style="flex: 1; max-width: 85%; margin: 0 auto; background-color: transparent; border-radius: 0; padding: 0; box-shadow: none; height: 650px; text-align: center;">
                                <!-- SVG do mapa -->
                                <svg id="map"
                                    style="width: 100%; height: 600px; display: block; margin: 0 auto; background-color: transparent; border: none; border-radius: 0;">
                                    <defs>
                                        <!-- Glow effect for restaurants -->
                                        <filter id="glow" x="-40%" y="-40%" width="180%" height="180%">
                                            <feGaussianBlur stdDeviation="2" result="blur" />
                                            <feComposite in="SourceGraphic" in2="blur" operator="over" />
                                        </filter>
                                        <!-- Enhanced glow for highlighted restaurants -->
                                        <filter id="glow-highlight" x="-40%" y="-40%" width="180%" height="180%">
                                            <feGaussianBlur stdDeviation="3" result="blur" />
                                            <feComposite in="SourceGraphic" in2="blur" operator="over" />
                                        </filter>
                                    </defs>
                                </svg>
                                <div id="tooltip-map" class="tooltip"
                                    style="position: absolute; z-index: 1000; background-color: rgba(40, 40, 40, 0.9); color: white; padding: 10px; border-radius: 6px; pointer-events: none; opacity: 0; transition: opacity 0.2s ease-in-out; box-shadow: 0 3px 14px rgba(0,0,0,0.25);">
                                </div>


                            </div>

                            <!-- Cuisine Types legend positioned to show full text -->
                            <div class="legend"
                                style="position:absolute; top:20px; right:-140px; background:white; padding:10px; border-radius:5px; color:#333; font-size:12px; z-index:10; max-width:180px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                <h3
                                    style="font-size:14px; margin:0 0 8px 0; color:#111; border-bottom:1px solid #eee; padding-bottom:4px; font-weight:bold;">
                                    Cuisine Types</h3>
                                <div id="legend-groups" style="display: flex; flex-direction: column; gap: 5px;">
                                    <!-- Content filled dynamically by JavaScript -->
                                </div>
                            </div>
                            <!-- Map Controls - Simplified -->
                            <div class="controls"
                                style="position:absolute; bottom:20px; left:20px; background:white; padding:10px; border-radius:5px; color:#333; z-index:10; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                                <h3
                                    style="font-size:14px; margin:0 0 5px 0; color:#111; border-bottom:1px solid #eee; padding-bottom:4px;">
                                    Controls</h3>
                                <p style="font-size:12px; margin:0 0 8px 0;">Click on a country to zoom in</p>
                                <div>
                                    <button
                                        style="background:#f8f8f8; color:#333; border:1px solid #ddd; border-radius:4px; padding:6px 12px; font-size:12px; cursor:pointer; transition:all 0.2s; box-shadow:0 1px 3px rgba(0,0,0,0.05);"
                                        id="mapResetZoomBtn" onmouseover="this.style.background='#efefef'"
                                        onmouseout="this.style.background='#f8f8f8'">Reset Map</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <style>
                /* Estilos modernos para mapa e visualiza√ß√µes */
                .tooltip-map.active,
                #tooltip-map.active {
                    opacity: 1 !important;
                    transform: scale(1) !important;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    background: rgba(40, 40, 40, 0.85) !important;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    display: block !important;
                    z-index: 1000;
                    visibility: visible !important;
                }

                /* Estilos refinados para itens da legenda */
                .legend-item {
                    cursor: pointer;
                    margin: 3px 0;
                    padding: 7px 10px;
                    border-radius: 6px;
                    transition: all 0.25s cubic-bezier(0.165, 0.84, 0.44, 1);
                    display: flex;
                    align-items: center;
                    font-size: 12px;
                    color: #333;
                    background: rgba(255, 255, 255, 0.5);
                    border-left: 3px solid transparent;
                }

                .legend-item:hover {
                    background-color: #f0f4f8;
                    transform: translateX(2px);
                    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
                    border-left-color: #e74c3c;
                }

                .legend-item.inactive {
                    opacity: 0.65;
                    filter: grayscale(40%);
                }

                .legend-item.inactive:hover {
                    opacity: 0.8;
                    background-color: #f0f4f8;
                }

                .legend-color {
                    display: inline-block;
                    width: 14px;
                    height: 14px;
                    margin-right: 8px;
                    vertical-align: middle;
                    border-radius: 4px;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                }

                .legend-group {
                    margin-bottom: 14px;
                }

                .legend-group-title {
                    font-size: 12px;
                    font-weight: 600;
                    margin-bottom: 6px;
                    padding-bottom: 4px;
                    border-bottom: 2px solid #f0f0f0;
                    color: #333;
                    letter-spacing: 0.5px;
                }

                /* Estiliza√ß√£o moderna para o controle deslizante de ano */
                input[type="range"] {
                    height: 30px;
                    -webkit-appearance: none;
                    margin: 10px 0;
                    width: 100%;
                    background: transparent;
                    border: none;
                    outline: none;
                    position: relative;
                    z-index: 5;
                    cursor: pointer;
                }

                input[type="range"]:focus {
                    outline: none;
                    border: none;
                }

                input[type="range"]::-webkit-slider-runnable-track {
                    width: 100%;
                    height: 8px;
                    cursor: pointer;
                    animate: 0.2s;
                    background: linear-gradient(to right, rgba(231, 76, 60, 0.3), rgba(231, 76, 60, 0.9));
                    border-radius: 0;
                    box-shadow: none;
                    border: none;
                    outline: none;
                }

                input[type="range"]::-webkit-slider-thumb {
                    -webkit-appearance: none;
                    appearance: none;
                    /* Standard property */
                    height: 20px;
                    /* Still need some size for interaction */
                    width: 12px;
                    margin-top: -4px;
                    /* Adjust to center on a 6px high track, if track height changes adjust this */
                    background: transparent;
                    /* Make default thumb invisible */
                    border: transparent;
                    /* Ensure border is also invisible */
                    box-shadow: none;
                    cursor: pointer;
                    border-radius: 50%;
                    /* Can make it round even if invisible, just in case */
                    transition: transform 0.2s ease;
                }

                input[type="range"]::-moz-range-thumb {
                    /* Firefox */
                    height: 20px;
                    width: 12px;
                    background: transparent;
                    border: transparent;
                    border-radius: 50%;
                    cursor: pointer;
                    border: none;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                }

                input[type="range"]::-ms-thumb {
                    /* IE/Edge */
                    height: 20px;
                    width: 12px;
                    background: transparent;
                    border: transparent;
                    border-radius: 50%;
                    cursor: pointer;
                    border: none;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                }

                input[type="range"]::-webkit-slider-thumb:hover {
                    transform: scale(1.1);
                    box-shadow: 0 2px 6px rgba(231, 76, 60, 0.6);
                }

                input[type="range"]:active::-webkit-slider-thumb {
                    transform: scale(1.15);
                    box-shadow: 0 3px 8px rgba(231, 76, 60, 0.7);
                }

                /* Estiliza√ß√£o dos bot√µes */
                #playPauseBtn {
                    background: linear-gradient(145deg, #e74c3c, #c0392b);
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 32px;
                    height: 32px;
                    margin-right: 12px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-shrink: 0;
                    box-shadow: 0 2px 6px rgba(231, 76, 60, 0.18);
                    transition: all 0.2s ease;
                }

                #playPauseBtn i {
                    font-size: 14px !important;
                }

                #playPauseBtn:hover {
                    transform: scale(1.05);
                    box-shadow: 0 4px 10px rgba(231, 76, 60, 0.4);
                }

                #playPauseBtn:active {
                    transform: scale(0.98);
                }

                #resetBtn {
                    background: #f8f8f8;
                    color: #333;
                    border: none;
                    border-radius: 0;
                    padding: 8px 16px;
                    margin-left: 15px;
                    cursor: pointer;
                    font-size: 14px;
                    font-weight: 500;
                    flex-shrink: 0;
                    box-shadow: none;
                    transition: all 0.2s ease;
                }

                #resetBtn:hover {
                    background: #ebebeb;
                    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
                }

                /* Estiliza√ß√£o da se√ß√£o de tipos de cozinha */
                #legend {
                    background: #ffffff;
                    padding: 22px;
                    border-radius: 12px;
                    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
                    border: 1px solid #f0f0f0;
                }

                #legend h3 {
                    margin-top: 0;
                    margin-bottom: 18px;
                    font-size: 20px;
                    font-weight: 600;
                    color: #333;
                    border-bottom: 2px solid #f0f0f0;
                    padding-bottom: 12px;
                    letter-spacing: 0.5px;
                }

                /* Melhorias no mapa e containers */
                #map {
                    width: 100%;
                    height: 600px;
                    display: block;
                    background-color: #ffffff;
                    border: none;
                    /* Removed border */
                    border-radius: 10px;
                    /* Kept border-radius for consistency if needed elsewhere */
                    box-shadow: none;
                    /* Removed inner shadow */
                }

                .tick-marks {
                    display: flex;
                    justify-content: space-between;
                    width: 100%;
                    margin-top: 10px;
                }

                .tick-marks span {
                    font-size: 12px;
                    font-weight: 500;
                    color: #555;
                }

                /* Visualiza√ß√£o dos n√≥s do gr√°fico de bolhas */
                .node {
                    transition: all 0.3s ease;
                }

                .node:hover {
                    filter: brightness(1.05);
                }

                #tooltip-map {
                    transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
                    position: absolute;
                    background: rgba(40, 40, 40, 0.9);
                    color: #fff;
                    padding: 10px 15px;
                    border-radius: 6px;
                    font-size: 13px;
                    pointer-events: none;
                    opacity: 0;
                    transform: scale(0.95);
                    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
                    z-index: 9999;
                }
            </style>

            <script src="https://d3js.org/d3.v7.min.js"></script>
            <script src="https://unpkg.com/topojson-client@3"></script>

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    console.log("Map initialization starting...");
                    const svg = d3.select("#map");
                    d3.select("#map").selectAll("*").remove();
                    const width = svg.node().getBoundingClientRect().width;
                    const height = 600;

                    svg.attr('width', width).attr('height', height);

                    // Change projection to EqualEarth with proper fit
                    const projection = d3.geoEqualEarth()
                        .fitExtent([[40, 20], [width - 40, height - 20]], { type: "Sphere" });
                    const path = d3.geoPath(projection);
                    const g = svg.append("g");

                    // Adiciona o fundo preto para os oceanos
                    g.append("path")
                        .datum({ type: "Sphere" })
                        .attr("class", "sphere-background")
                        .attr("d", path)
                        .attr("fill", "#000000");

                    // Adiciona o contorno oval suave
                    g.append("path")
                        .datum({ type: "Sphere" })
                        .attr("class", "sphere-outline")
                        .attr("d", path)
                        .attr("fill", "none")
                        .attr("stroke", "#444")
                        .attr("stroke-width", 0.5);

                    // Direct DOM reference instead of D3 selection
                    const tooltipElement = document.getElementById("tooltip-map");
                    const tooltip = d3.select("#tooltip-map");

                    // Define broader cuisine categories mapping
                    const cuisineMapping = {
                        // European Cuisines (excluding French and Italian which get their own categories)
                        "Modern Dutch / European": "European",
                        "Modern British / European": "European",
                        "Modern German / European": "European",
                        "Modern Austrian": "European",
                        "New Nordic": "European",
                        "Modern Slovenian / Alpine": "European",

                        // French Cuisine
                        "French": "French",
                        "French / Modern European": "French",
                        "Belgian / French": "French",

                        // Italian Cuisine
                        "Italian": "Italian",
                        "Italian / Modernist": "Italian",

                        // North American Cuisines
                        "Contemporary Canadian": "North American",
                        "Contemporary American": "North American",
                        "French / Contemporary American": "North American",

                        // East/Southeast Asian Cuisines
                        "Chinese": "East/Southeast Asian",
                        "Japanese": "East/Southeast Asian",
                        "Thai": "East/Southeast Asian",

                        // Asian Fusion & Australian Cuisines
                        "Modern Australian / Asian Fusion": "Asian Fusion & Australian",
                        "Modern Asian / Fusion": "Asian Fusion & Australian",
                        "French / Mauritian Fusion": "Asian Fusion & Australian",
                        "Modern Australian": "Asian Fusion & Australian",

                        // Indian Subcontinent Cuisines
                        "Progressive Indian": "Indian Subcontinent",
                        "Indian": "Indian Subcontinent",

                        // Latin American Cuisines
                        "Peruvian / Nikkei": "Latin American",
                        "Brazilian / Amazonian": "Latin American",
                        "Brazilian": "Latin American",
                        "Mexican": "Latin American",
                        "Argentinian": "Latin American",

                        // Iberian Cuisines
                        "Portuguese": "Iberian",
                        "Spanish": "Iberian",
                        "Modernist / Spanish": "Iberian",

                        // Russian Cuisine
                        "Modern Russian": "Russian"
                    };

                    let cuisineColors = {};
                    let sortedCuisineNames = []; // Will store sorted broad cuisine names

                    const warmColorPalette = [
                        "#B71C1C", // Dark Red
                        "#C62828",
                        "#D32F2F",
                        "#E53935", // Red
                        "#F4511E", // Deep Orange
                        "#FB8C00", // Orange
                        "#FFB300", // Amber
                        "#FDD835", // Yellow
                        "#FFEE58",
                        "#FFF176", // Light Yellow
                        "#FFF59D",
                        "#FFF9C4"  // Very Light Yellow
                    ];

                    let activeCuisines = new Set();
                    const data = [];
                    let selectedCountryFeature = null;

                    console.log("Loading data from CSV...");
                    d3.csv("data-set/05_WorldsBestRestaurants_Updated.csv").then(csvData => {
                        console.log("CSV data loaded successfully:", csvData.length, "entries");
                        csvData.forEach(d => {
                            const lat = +d.lat;
                            const lng = +d.lng;
                            if (isNaN(lat) || isNaN(lng)) {
                                return;
                            }
                            data.push({
                                year: +d.year,
                                restaurant: d.restaurant,
                                rank: +d.rank || 0,
                                location: d.location || "",
                                country: d.country || "",
                                lat: lat,
                                lng: lng,
                                cuisine: d.Cuisine, // Original cuisine name from CSV
                                broadCuisine: cuisineMapping[d.Cuisine] || d.Cuisine, // Mapped broader category or original if no mapping
                                description: d.Description || ""
                            });
                        });

                        // Verify data is loaded
                        console.log(`Loaded ${data.length} restaurant data points`);
                        if (data.length > 0) {
                            console.log("Sample data entry:", data[0]);
                        }

                        const uniqueCuisines = [...new Set(data.map(d => d.broadCuisine).filter(c => c))]
                            .sort((a, b) => a.localeCompare(b));
                        sortedCuisineNames = uniqueCuisines; // Store sorted broad names
                        uniqueCuisines.forEach((broadCuisine, index) => {
                            cuisineColors[broadCuisine] = warmColorPalette[index % warmColorPalette.length];
                        });
                        activeCuisines = new Set(uniqueCuisines); // Initialize with all unique broad cuisines
                        sortedCuisineNames = [...uniqueCuisines];

                        console.log("Loading world map data...");
                        d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json").then(world => {
                            console.log("World map data loaded successfully");
                            const countries = topojson.feature(world, world.objects.countries);

                            g.append("g")
                                .selectAll("path")
                                .data(countries.features)
                                .join("path")
                                .attr("class", "country")
                                .attr("fill", "#ffffff") // Branco puro para os pa√≠ses
                                .attr("stroke", "#444") // Contorno mais escuro, semelhante ao globo
                                .attr("stroke-width", 0.25) // Espessura reduzida para ficar mais sutil
                                .attr("d", path)
                                .on("mouseover", function (event, d) {
                                    if (d !== selectedCountryFeature) {
                                        d3.select(this).attr("fill", "#feece9");  // New hover color
                                    }
                                    if (d && d.properties && d.properties.name) {
                                        tooltip.classed("active", true)
                                            .html(`
                                                <div style="text-align: center; border-bottom: 1px solid #eee; padding-bottom: 4px; margin-bottom: 4px;">
                                                    <strong style="font-size: 13px; color: #333;">${d.properties.name}</strong>
                                                </div>
                                                <div style="display: flex; align-items: center; justify-content: center;">
                                                    <span style="font-size: 12px; color: #555;">Click to focus</span>
                                                </div>
                                            `)
                                            .style("left", (event.pageX + 15) + "px")
                                            .style("top", (event.pageY - 15) + "px")
                                            .style("display", "block");
                                    } else {
                                        tooltip.classed("active", false);
                                    }
                                })
                                .on("mousemove", function (event) {
                                    if (tooltip.classed("active")) {
                                        tooltip.style("left", (event.pageX + 15) + "px")
                                            .style("top", (event.pageY - 15) + "px");
                                    }
                                })
                                .on("mouseout", function (event, d) {
                                    if (d !== selectedCountryFeature) {
                                        d3.select(this).attr("fill", "#ffffff");
                                    }
                                    tooltip.classed("active", false)
                                        .style("display", "none");
                                })
                                .on("click", function (event, d) {
                                    // Deselect previous country and revert its style
                                    if (selectedCountryFeature && selectedCountryFeature !== d) {
                                        g.selectAll("path.country")
                                            .filter(pathData => pathData === selectedCountryFeature)
                                            .attr("fill", "#ffffff"); // Revert to original default color for countries
                                    }

                                    if (selectedCountryFeature === d) {
                                        // Clicked the same country again: deselect and reset zoom
                                        selectedCountryFeature = null;
                                        d3.select(this).attr("fill", "#ffffff"); // Revert to original color (branco puro)
                                        svg.transition().duration(750).call(
                                            zoom.transform,
                                            d3.zoomIdentity // Reset to default view
                                        );
                                    } else {
                                        // New country selected
                                        selectedCountryFeature = d;
                                        d3.select(this).attr("fill", "#feece9"); // New selected color

                                        // Calculate bounds and zoom
                                        const bounds = path.bounds(d);
                                        const dx = bounds[1][0] - bounds[0][0];
                                        const dy = bounds[1][1] - bounds[0][1];
                                        const x = (bounds[0][0] + bounds[1][0]) / 2;
                                        const y = (bounds[0][1] + bounds[1][1]) / 2;

                                        // Add padding factor to the scale calculation - more zoom for US and large countries
                                        const padding = 0.5; // Reduced for much stronger zoom effect

                                        // For larger countries like US, apply even stronger zoom
                                        const isLargeCountry = dx > width / 3 || dy > height / 3;
                                        const scaleFactor = isLargeCountry ? 2.5 : 1;

                                        const scale = Math.max(1, Math.min(8, (padding / Math.max(dx / width, dy / height)) * scaleFactor));
                                        const translate = [width / 2 - scale * x, height / 2 - scale * y];

                                        // Apply transformation with delay to ensure it's executed correctly
                                        setTimeout(() => {
                                            console.log(`Zooming to country: scale=${scale}, dx=${dx}, dy=${dy}`);
                                            svg.transition().duration(750).call(
                                                zoom.transform,
                                                d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale)
                                            );
                                        }, 50);
                                    }
                                    filterBubbles();
                                });

                            // Remove sphere background (oval shape)
                            // g.insert("path", ":first-child")
                            //    .datum({ type: "Sphere" })
                            //    .attr("class", "sphere")
                            //    .attr("d", path)
                            //    .attr("fill", "none")
                            //    .attr("stroke", "#ccc")
                            //    .attr("stroke-width", 0.5);

                            console.log("Initial map update for year 2023");
                            updateMap(2023);
                            createLegend();
                        }).catch(error => console.error("Error loading world map data:", error));
                    }).catch(error => {
                        console.error("Error loading CSV data:", error);
                        // Remove fallback sample data to ensure we're using actual data only
                    });

                    function filterBubbles() {
                        console.log("Filtering bubbles. Selected country: ", selectedCountryFeature ? "Yes" : "No");

                        g.selectAll("circle.restaurant-bubble")
                            .transition()
                            .duration(300)
                            .each(function (d) { // Use .each to evaluate conditions per bubble
                                const bubble = d3.select(this);
                                const cuisineIsActive = activeCuisines.has(d.broadCuisine);

                                // Country matching logic
                                let countryMatch = true; // Default to true if no country selected
                                if (selectedCountryFeature) {
                                    // More reliable point-in-polygon test for the US and other countries
                                    try {
                                        // Try with standard geoContains first
                                        countryMatch = d3.geoContains(selectedCountryFeature, [d.lng, d.lat]);

                                        // Special case for USA and other large countries - use a more tolerant approach
                                        if (!countryMatch && selectedCountryFeature.properties &&
                                            (selectedCountryFeature.properties.name === "United States of America" ||
                                                selectedCountryFeature.properties.name === "USA")) {
                                            // For US, check if point is within reasonable bounds of US mainland
                                            countryMatch = (d.lng >= -125 && d.lng <= -66 && d.lat >= 24 && d.lat <= 50);
                                        }
                                    } catch (e) {
                                        console.error("Error in geo matching:", e);
                                        countryMatch = true; // Fall back to showing points on error
                                    }
                                }

                                const isActiveAndMatches = cuisineIsActive && countryMatch;

                                if (countryMatch && selectedCountryFeature) {
                                    console.log(`Restaurant ${d.restaurant} matches country: ${countryMatch}, coords: ${d.lng},${d.lat}`);
                                }

                                bubble.style("opacity", isActiveAndMatches ? 0.9 : 0.05) // More faint if not matching
                                    .attr("r", isActiveAndMatches ? 6 : 2)          // Smaller if not matching
                                    .attr("filter", isActiveAndMatches ? "url(#glow)" : "none")
                                    .attr("pointer-events", isActiveAndMatches ? "all" : "none");
                            });
                    }

                    function updateMap(year) {
                        // Log to verify year filtering
                        console.log(`Updating map for year: ${year}`);

                        // Make updateMap globally available immediately
                        window.updateMap = updateMap;

                        // Filter restaurants for the selected year
                        const filteredData = data.filter(d => d.year === year);
                        console.log(`Found ${filteredData.length} restaurants for year ${year}`);

                        // Clear existing bubbles before drawing new ones
                        g.selectAll("circle.restaurant-bubble").remove();

                        const bubbles = g.selectAll("circle.restaurant-bubble")
                            .data(filteredData, d => d.restaurant);

                        bubbles.enter()
                            .append("circle")
                            .attr("class", "restaurant-bubble")
                            .attr("cx", d => projection([d.lng, d.lat])[0])
                            .attr("cy", d => projection([d.lng, d.lat])[1])
                            .attr("r", 0)
                            .attr("stroke", "#fff")
                            .attr("stroke-width", 1)
                            .attr("fill", d => cuisineColors[d.broadCuisine] || "#999")
                            .style("cursor", "pointer")
                            .style("opacity", 0)
                            .attr("filter", "url(#glow)")
                            .on("mouseover", function (event, d) {
                                if (!activeCuisines.has(d.broadCuisine)) return;
                                let countryMatch = true;
                                if (selectedCountryFeature) {
                                    countryMatch = d3.geoContains(selectedCountryFeature, [d.lng, d.lat]);
                                }
                                if (!countryMatch) return;

                                // Highlight the bubble
                                d3.select(this)
                                    .transition()
                                    .duration(150)
                                    .attr("r", 9)
                                    .attr("stroke-width", 2.5)
                                    .attr("filter", "url(#glow-highlight)");

                                // Using DOM manipulation for the tooltip with forced display
                                const tooltipEl = document.getElementById("tooltip-map");
                                if (tooltipEl) {
                                    // Build rich tooltip content
                                    tooltipEl.innerHTML = `
                                        <div style="text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 6px; margin-bottom: 6px;">
                                            <strong style="font-size: 14px; color: #fff;">${d.restaurant}</strong>
                                        </div>
                                        <div style="display: flex; flex-direction: column; align-items: center;">
                                            <div style="margin-bottom: 4px; display: flex; align-items: center;">
                                                <span style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: ${cuisineColors[d.broadCuisine] || "#999"}; margin-right: 6px;"></span>
                                                <span style="font-size: 12px; color: #fff;">${d.cuisine || "Unknown cuisine"}</span>
                                            </div>
                                            <span style="font-size: 11px; color: rgba(255,255,255,0.7);">Rank: #${d.rank} (${d.year})</span>
                                            <span style="font-size: 11px; color: rgba(255,255,255,0.7);">${d.location}, ${d.country}</span>
                                        </div>
                                    `;

                                    // Position and show the tooltip
                                    tooltipEl.style.left = (event.pageX + 15) + "px";
                                    tooltipEl.style.top = (event.pageY - 15) + "px";
                                    tooltipEl.style.opacity = "1";
                                    tooltipEl.style.display = "block";
                                    tooltipEl.style.visibility = "visible";
                                    tooltipEl.style.position = "absolute";
                                    tooltipEl.style.pointerEvents = "none";
                                    tooltipEl.style.zIndex = "9999";

                                    // Also add the active class
                                    tooltipEl.classList.add("active");

                                    console.log("Tooltip shown for:", d.restaurant);
                                }
                            })
                            .on("mousemove", function (event) {
                                const tooltipEl = document.getElementById("tooltip-map");
                                if (tooltipEl && tooltipEl.style.opacity !== "0") {
                                    tooltipEl.style.left = (event.pageX + 15) + "px";
                                    tooltipEl.style.top = (event.pageY - 15) + "px";
                                }
                            })
                            .on("mouseout", function (event, d) { // Added d to access data if needed
                                const cuisineIsActive = activeCuisines.has(d.broadCuisine);
                                let countryMatch = true;
                                if (selectedCountryFeature) {
                                    countryMatch = d3.geoContains(selectedCountryFeature, [d.lng, d.lat]);
                                }
                                const isActiveAndMatches = cuisineIsActive && countryMatch;
                                const targetRadius = isActiveAndMatches ? 6 : 2;
                                const targetFilter = isActiveAndMatches ? "url(#glow)" : "none";

                                d3.select(this)
                                    .transition()
                                    .duration(150)
                                    .attr("r", targetRadius)
                                    .attr("stroke-width", 1)
                                    .attr("filter", targetFilter);

                                const tooltipEl = document.getElementById("tooltip-map");
                                if (tooltipEl) {
                                    tooltipEl.classList.remove("active");
                                    tooltipEl.style.opacity = "0";
                                    tooltipEl.style.display = "none";
                                    tooltipEl.style.visibility = "hidden";
                                }
                            })
                            .transition()
                            .duration(500)
                            .attr("r", 6)
                            .style("opacity", 0.9);

                        bubbles.transition()
                            .duration(500)
                            .attr("cx", d => projection([d.lng, d.lat])[0])
                            .attr("cy", d => projection([d.lng, d.lat])[1])
                            .attr("r", 6)
                            .style("opacity", d => {
                                const cuisineIsActive = activeCuisines.has(d.broadCuisine);
                                let countryMatch = true;
                                if (selectedCountryFeature) {
                                    countryMatch = d3.geoContains(selectedCountryFeature, [d.lng, d.lat]);
                                }
                                return cuisineIsActive && countryMatch ? 0.85 : 0.1;
                            });

                        bubbles.exit()
                            .transition()
                            .duration(300)
                            .attr("r", 0)
                            .style("opacity", 0)
                            .remove();

                        filterBubbles();
                    }

                    function createLegend() {
                        console.log("Creating legend...");
                        const legendEl = d3.select("#legend-groups");
                        legendEl.html(""); // Clear existing items thoroughly

                        // Ensure cuisineColors is populated (should be by the time this is called)
                        if (Object.keys(cuisineColors).length === 0) {
                            console.log("Warning: cuisineColors not populated yet");
                            // Fallback, though ideally data is loaded and cuisineColors populated before first call
                            const uniqueCuisinesForColor = [...new Set(data.map(d => d.cuisine).filter(c => c))];
                            uniqueCuisinesForColor.forEach((cuisine, index) => {
                                cuisineColors[cuisine] = warmColorPalette[index % warmColorPalette.length];
                            });
                            // If activeCuisines is not yet populated (e.g. data just loaded), populate it
                            if (activeCuisines.size === 0) {
                                activeCuisines = new Set(Object.keys(cuisineColors));
                            }
                        }

                        // Sort cuisine names by color value, then alphabetically as a secondary sort
                        const displayCuisineNames = Object.keys(cuisineColors).sort((a, b) => {
                            const colorA = cuisineColors[a].toUpperCase();
                            const colorB = cuisineColors[b].toUpperCase();
                            if (colorA < colorB) return -1;
                            if (colorA > colorB) return 1;
                            return a.localeCompare(b);
                        });

                        displayCuisineNames.forEach(cuisine => {
                            const itemRow = legendEl.append("div")
                                .attr("class", "legend-cuisine-item")
                                .style("display", "flex")
                                .style("align-items", "center")
                                .style("margin-bottom", "3px")
                                .style("padding", "3px 5px")
                                .style("border-radius", "3px")
                                .style("cursor", "pointer")
                                .style("opacity", activeCuisines.has(cuisine) ? 1 : 0.5)
                                .on("click", function () {
                                    if (activeCuisines.has(cuisine)) {
                                        activeCuisines.delete(cuisine);
                                        d3.select(this).style("opacity", 0.5);
                                    } else {
                                        activeCuisines.add(cuisine);
                                        d3.select(this).style("opacity", 1);
                                    }
                                    filterBubbles();
                                })
                                .on("mouseover", function () {
                                    if (!activeCuisines.has(cuisine)) { // Only highlight if inactive for visual cue
                                        d3.select(this).style("background-color", "#f0f0f0");
                                    }
                                })
                                .on("mouseout", function () {
                                    d3.select(this).style("background-color", "transparent");
                                });

                            itemRow.append("div") // Color swatch
                                .style("width", "10px")
                                .style("height", "10px")
                                .style("min-width", "10px")
                                .style("margin-right", "4px")
                                .style("border-radius", "2px")
                                .style("background-color", cuisineColors[cuisine] || "#888888")
                                .style("border", "1px solid rgba(0,0,0,0.05)");

                            itemRow.append("span") // Cuisine name
                                .text(cuisine)
                                .style("font-size", "11px")
                                .style("line-height", "1.3")
                                .style("color", "#333")
                                .style("white-space", "normal")
                                .style("overflow", "visible");
                        });
                        console.log("Legend created with", displayCuisineNames.length, "cuisines");
                    }

                    // Timeline animation variables
                    let animationInterval = null;
                    let isPlaying = false;

                    // Initialize playback controls
                    document.getElementById("playPauseBtn").addEventListener("click", function () {
                        console.log("Play/pause button clicked");
                        if (isPlaying) {
                            // Pause
                            clearInterval(animationInterval);
                            this.innerHTML = '<i class="fa fa-play" style="font-size: 12px;"></i>';
                        } else {
                            // Play
                            this.innerHTML = '<i class="fa fa-pause" style="font-size:12px;"></i>';
                            const slider = document.getElementById("yearSlider");
                            const min = +slider.min;
                            const max = +slider.max;

                            // If at the end, reset to beginning
                            if (+slider.value >= max) {
                                slider.value = min;
                                document.getElementById("yearDisplay").textContent = min;
                                updateMap(min);
                            }

                            animationInterval = setInterval(() => {
                                let currentValue = +slider.value;
                                if (currentValue < max) {
                                    currentValue++;
                                    slider.value = currentValue;
                                    document.getElementById("yearDisplay").textContent = currentValue;
                                    updateMap(currentValue);
                                } else {
                                    // Stop at end
                                    clearInterval(animationInterval);
                                    isPlaying = false;
                                    this.innerHTML = '<i class="fa fa-play" style="font-size:12px;"></i>';
                                }
                            }, 1000); // 1 second interval
                        }
                        isPlaying = !isPlaying;
                    });

                    // Reset button
                    document.getElementById("resetBtn").addEventListener("click", function () {
                        // Stop animation if playing
                        if (isPlaying) {
                            clearInterval(animationInterval);
                            isPlaying = false;
                            document.getElementById("playPauseBtn").innerHTML = '<i class="fa fa-play" style="font-size:12px;"></i>';
                        }

                        // Reset to initial year (2002)
                        const slider = document.getElementById("yearSlider");
                        slider.value = 2002;
                        document.getElementById("yearDisplay").textContent = "2002";
                        updateMap(2002);
                    });

                    // Inicializar a posi√ß√£o do thumb
                    const initialYear = +document.getElementById("yearSlider").value;
                    const percent = (initialYear - 2002) / (2023 - 2002);
                    const thumbPosition = percent * 100;
                    if (document.getElementById("sliderThumb")) {
                        document.getElementById("sliderThumb").style.right = `${100 - thumbPosition}%`;
                    }

                    // Configura√ß√£o fixa do zoom - s√≥ para pa√≠ses
                    const zoom = d3.zoom()
                        .scaleExtent([1, 5]) // Limita o zoom m√°ximo
                        .translateExtent([[0, 0], [width, height]])
                        .on("zoom", event => {
                            g.attr("transform", event.transform);
                        });

                    // Aplicamos o zoom mas desabilitamos eventos do mouse
                    svg.call(zoom).on("mousedown.zoom", null).on("touchstart.zoom", null)
                        .on("wheel.zoom", null).on("dblclick.zoom", null);

                    // Simplificamos para apenas o bot√£o de reset
                    if (document.getElementById("mapResetZoomBtn")) {
                        document.getElementById("mapResetZoomBtn").addEventListener("click", () => {
                            svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
                            if (selectedCountryFeature) {
                                g.selectAll("path.country")
                                    .filter(pathData => pathData === selectedCountryFeature)
                                    .attr("fill", "#ffffff");
                                selectedCountryFeature = null;
                                filterBubbles();
                            }
                        });
                    }

                    window.addEventListener('resize', function () {
                        const newWidth = svg.node().getBoundingClientRect().width;
                        svg.attr('width', newWidth);
                        projection.fitExtent([[40, 20], [newWidth - 40, height - 20]], { type: "Sphere" });
                        g.selectAll("path").attr("d", path);
                        g.selectAll("circle.restaurant-bubble")
                            .attr("cx", d => projection([d.lng, d.lat])[0])
                            .attr("cy", d => projection([d.lng, d.lat])[1]);
                    });
                });

                // Atualiza a barra de progresso do slider
                function updateSliderProgress() {
                    const slider = document.getElementById('yearSlider');
                    const progress = document.getElementById('sliderProgress');
                    if (slider && progress) {
                        const min = +slider.min;
                        const max = +slider.max;
                        const val = +slider.value;
                        const percent = (val - min) / (max - min);
                        progress.style.width = (percent * 100) + '%';
                    }
                }

                // Wait for DOM to be fully loaded before adding event listeners
                document.addEventListener('DOMContentLoaded', function () {
                    const yearSlider = document.getElementById('yearSlider');
                    if (yearSlider) {
                        // Adiciona o listener para updateSliderProgress e tamb√©m para atualizar o mapa
                        yearSlider.addEventListener('input', function () {
                            // Atualiza a barra de progresso
                            updateSliderProgress();

                            // Atualiza o ano exibido e o mapa
                            const year = this.value;
                            const yearDisplay = document.getElementById('yearDisplay');
                            if (yearDisplay) {
                                yearDisplay.textContent = year;
                            }
                            if (typeof window.updateMap === 'function') {
                                window.updateMap(Number(year));
                            }
                        });
                        updateSliderProgress(); // Initial update
                    }

                    // Map controls event listeners
                    const mapResetZoomBtn = document.getElementById("mapResetZoomBtn");

                    if (mapResetZoomBtn) {
                        mapResetZoomBtn.addEventListener("click", () => {
                            if (svg) {
                                svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
                                if (selectedCountryFeature) {
                                    g.selectAll("path.country")
                                        .filter(pathData => pathData === selectedCountryFeature)
                                        .attr("fill", "#ffffff");
                                    selectedCountryFeature = null;
                                    filterBubbles();
                                }
                            }
                        });
                    }
                });
            </script>

            <script>
                // √önico evento para o slider, adicionado diretamente
                document.addEventListener('DOMContentLoaded', function () {
                    const yearSlider = document.getElementById('yearSlider');
                    const yearDisplay = document.getElementById('yearDisplay');
                    if (yearSlider && yearDisplay) {
                        yearSlider.addEventListener('input', function () {
                            const year = this.value;
                            yearDisplay.textContent = year;
                            if (typeof window.updateMap === 'function') {
                                window.updateMap(Number(year));
                            } else {
                                console.error('window.updateMap n√£o est√° dispon√≠vel');
                            }
                        });
                    }
                });
            </script>
            <!-- Globe Visualization Section -->
            <section class="scrollto text-center" id="globe-section" style="background:#fff; padding:60px 0;">
                <div class="row clearfix">
                    <div class="section-heading">
                        <h3 style="color:#888">EXPLORE</h3>
                        <h2 class="section-title">Global Cuisine Map</h2>
                        <p class="section-subtitle">
                            Discover the distribution of recipes from around the world. Use the controls to explore the
                            interactive map.
                        </p>
                    </div>

                    <div class="globe-container"
                        style="position:relative; width:100%; max-width:1200px; margin:0 auto;">
                        <div id="globe" style="height:650px; width:100%;"></div>

                        <div class="controls"
                            style="position:absolute; bottom:20px; left:20px; background:white; padding:10px; border-radius:5px; color:#333; z-index:10; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3
                                style="font-size:14px; margin:0 0 5px 0; color:#111; border-bottom:1px solid #eee; padding-bottom:4px;">
                                Controls</h3>
                            <p style="font-size:12px; margin:0 0 8px 0;">Drag to rotate</p>
                            <div>
                                <button
                                    style="background:#f8f8f8; color:#333; border:1px solid #ddd; border-radius:4px; padding:6px 12px; font-size:12px; cursor:pointer; margin-right:6px; transition:all 0.2s; box-shadow:0 1px 3px rgba(0,0,0,0.05);"
                                    id="zoomIn" onmouseover="this.style.background='#efefef'"
                                    onmouseout="this.style.background='#f8f8f8'">Zoom +</button>
                                <button
                                    style="background:#f8f8f8; color:#333; border:1px solid #ddd; border-radius:4px; padding:6px 12px; font-size:12px; cursor:pointer; margin-right:6px; transition:all 0.2s; box-shadow:0 1px 3px rgba(0,0,0,0.05);"
                                    id="zoomOut" onmouseover="this.style.background='#efefef'"
                                    onmouseout="this.style.background='#f8f8f8'">Zoom ‚àí</button>
                                <button
                                    style="background:#f8f8f8; color:#333; border:1px solid #ddd; border-radius:4px; padding:6px 12px; font-size:12px; cursor:pointer; transition:all 0.2s; box-shadow:0 1px 3px rgba(0,0,0,0.05);"
                                    id="resetView" onmouseover="this.style.background='#efefef'"
                                    onmouseout="this.style.background='#f8f8f8'">Reset</button>
                            </div>
                        </div>

                        <div class="legend"
                            style="position:absolute; top:20px; right:20px; background:white; padding:10px; border-radius:5px; color:#333; font-size:12px; z-index:10; max-width:150px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3
                                style="font-size:14px; margin:0 0 8px 0; color:#111; border-bottom:1px solid #eee; padding-bottom:4px;">
                                Recipe Regions</h3>
                            <div id="legendContent" style="display: flex; flex-direction: column; gap: 5px;"></div>
                        </div>

                        <div id="globe-tooltip"
                            style="display:none; position:absolute; background:white; padding:8px 12px; border-radius:4px; color:#333; pointer-events:none; font-size:13px; z-index:1000; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
                        </div>
                    </div>
                </div>
            </section>
            <!-- End of Globe Visualization Section -->

            <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
            <script>
                // Tooltip setup
                const globeTooltipElement = document.createElement("div");
                globeTooltipElement.id = "globe-tooltip-fixed";
                globeTooltipElement.style.cssText = "display:none; position:fixed; background:white; padding:10px 14px; border-radius:5px; color:#333; pointer-events:none; font-size:13px; z-index:2000; box-shadow:0 3px 15px rgba(0,0,0,0.2); max-width:220px; line-height:1.4;";
                document.body.appendChild(globeTooltipElement);

                let globeWidth = document.getElementById('globe').offsetWidth;
                let globeHeight = 650;
                const globeInitialScale = Math.min(globeWidth, globeHeight) * 0.45; // Reduzido para 0.45
                let globeProjection = d3.geoOrthographic()
                    .scale(globeInitialScale)
                    .translate([globeWidth / 2, globeHeight / 2]);
                let globePath = d3.geoPath().projection(globeProjection);

                const globeSvg = d3.select("#globe").append("svg")
                    .attr("width", globeWidth)
                    .attr("height", globeHeight)
                    .attr("viewBox", `0 0 ${globeWidth} ${globeHeight}`)
                    .style("display", "block");

                const globeG = globeSvg.append("g");

                function resizeGlobe() {
                    globeWidth = document.getElementById('globe').offsetWidth;
                    globeSvg.attr("width", globeWidth).attr("height", globeHeight).attr("viewBox", `0 0 ${globeWidth} ${globeHeight}`);
                    globeProjection.translate([globeWidth / 2, globeHeight / 2]);
                    globeProjection.scale(Math.min(globeWidth, globeHeight) * 0.45); // Reduzido para 0.45
                    globeSvg.selectAll("path").attr("d", globePath);
                }
                window.addEventListener("resize", resizeGlobe);

                const globeTooltip = d3.select("#globe-tooltip-fixed");

                const globeCategories = [
                    { name: "USA", count: 16118 },
                    { name: "Italy", count: 7504 },
                    { name: "Indian Subcontinent", count: 4058 },
                    { name: "Mexico", count: 3138 },
                    { name: "France", count: 2703 },
                    { name: "Canada", count: 1112 },
                    { name: "Caribbean", count: 1103 },
                    { name: "British Isles", count: 1075 },
                    { name: "Middle East", count: 993 },
                    { name: "China", count: 941 },
                    { name: "Greece", count: 934 },
                    { name: "Spain", count: 816 },
                    { name: "Thailand", count: 667 },
                    { name: "Africa", count: 631 },
                    { name: "African Countries", count: 20 }, // Added for Angola, Algeria, Botswana, Somalia
                    { name: "Japan", count: 580 },
                    { name: "Eastern Europe", count: 565 },
                    { name: "Australia & NZ", count: 494 },
                    { name: "Central Europe", count: 487 },
                    { name: "Scandinavia", count: 404 },
                    { name: "South America", count: 310 },
                    { name: "Korea", count: 301 },
                    { name: "Portugal", count: 138 },
                    { name: "Netherlands", count: 40 },
                    { name: "Belgium", count: 15 },
                    { name: "Central America", count: 14 }
                ];

                const categoryToIds = {
                    "USA": [840],
                    "Italy": [380],
                    "Indian Subcontinent": [356, 524, 586, 144, 64], // √çndia, Nepal, Paquist√£o, Sri Lanka, But√£o
                    "Mexico": [484],
                    "France": [250],
                    "Canada": [124],
                    "Caribbean": [28, 44, 52, 60, 92, 136, 192, 212, 214, 308, 312, 332, 388, 474, 500, 531, 533, 534, 535, 630, 652, 659, 660, 662, 663, 670, 780, 796, 850],
                    "British Isles": [826, 372, 831, 832, 833],
                    "Middle East": [48, 275, 364, 368, 376, 400, 414, 422, 512, 634, 682, 760, 784, 792, 887],
                    "China": [156, 158, 344, 446],
                    "Greece": [300],
                    "Spain": [724],
                    "Thailand": [764],
                    "Africa": [108, 120, 132, 140, 148, 174, 175, 178, 180, 204, 226, 231, 232, 262, 266, 270, 288, 324, 384, 404, 426, 430, 434, 450, 454, 466, 478, 480, 504, 508, 516, 562, 566, 624, 638, 646, 678, 686, 690, 694, 710, 716, 728, 729, 732, 748, 768, 788, 800, 818, 834, 854, 894, 12, 24, 72, 706],
                    "Japan": [392],
                    "Eastern Europe": [8, 70, 100, 112, 191, 203, 233, 348, 428, 440, 498, 499, 616, 642, 643, 688, 703, 705, 804, 807],
                    "Australia & NZ": [36, 554],
                    "Central Europe": [203, 276, 348, 616, 703, 705, 40, 756],
                    "Scandinavia": [208, 246, 352, 578, 752],
                    "South America": [32, 68, 76, 152, 170, 218, 328, 600, 604, 740, 858, 862],
                    "Korea": [408, 410],
                    "Portugal": [620],
                    "Netherlands": [528],
                    "Belgium": [56],
                    "Central America": [84, 188, 222, 320, 340, 558, 591]
                };


                // Configurar escala de cores
                const counts = globeCategories.map(c => c.count);
                const colorScale = d3.scaleQuantile()
                    .domain(counts.sort((a, b) => a - b))  // Ordenar do menor para o maior (para que mais receitas = mais escuro)
                    .range([
                        "#FFEAC0", // 26 - mais claro poss√≠vel ainda vis√≠vel  
                        "#FFE6B8", // 25
                        "#FFE3B3", // 24
                        "#FFDFAD", // 23
                        "#FFDBAB", // 22
                        "#FFD4A8", // 21
                        "#FFCEA9", // 20
                        "#FFBFA0", // 19
                        "#FFAF90", // 18
                        "#FF9F83", // 17
                        "#FF8D6F", // 16
                        "#FF7C5A", // 15 - substituto mais forte para tons demasiado claros
                        "#FD7B5C", // 14
                        "#FA6A48", // 13
                        "#F75A36", // 12
                        "#F2501E", // 11
                        "#E64524", // 10
                        "#D63929", // 9
                        "#C52C2C", // 8
                        "#B41F1F", // 7
                        "#A31212", // 6
                        "#910101", // 5
                        "#800000", // 4
                        "#6E0000", // 3
                        "#5C0000", // 2
                        "#4A0000"  // 1 - Vinho profundo
                    ]);

                globeCategories.forEach(c => c.color = colorScale(c.count));
                const categoriesData = {};
                globeCategories.forEach(c => categoriesData[c.name] = c);

                const idToCategory = {};
                for (const [catName, ids] of Object.entries(categoryToIds)) {
                    ids.forEach(id => idToCategory[id] = catName);
                }

                d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(world => {
                    // Sphere background for the globe
                    globeG.append("path")
                        .datum({ type: "Sphere" })
                        .attr("class", "sphere")
                        .attr("d", globePath);

                    const graticule = d3.geoGraticule();
                    globeG.append("path")
                        .datum(graticule)
                        .attr("class", "graticule")
                        .attr("d", globePath);

                    const countries = topojson.feature(world, world.objects.countries).features;

                    countries.forEach(country => {
                        const catName = idToCategory[country.id];
                        const countryName = country.properties.name || "Unknown";
                        let fillColor = "#eeeeee";
                        let tooltipHtml = `
                        <div style="text-align: center; border-bottom: 1px solid #eee; padding-bottom: 4px; margin-bottom: 4px;">
                            <strong style="font-size: 13px; color: #333;">${countryName}</strong>
                        </div>`;

                        if (catName && categoriesData[catName]) {
                            fillColor = categoriesData[catName].color;
                            tooltipHtml += `
                            <div style="font-size: 12px; color: #555; text-align: center;">
                                <div>Region: ${catName}</div>
                                <div>${categoriesData[catName].count.toLocaleString()} recipes</div>
                            </div>`;
                        } else {
                            tooltipHtml += `
                            <div style="display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 12px; color: #555;">0 recipes</span>
                            </div>`;
                        }

                        globeG.append("path")
                            .datum(country)
                            .attr("fill", fillColor)
                            .attr("d", globePath)
                            .on("mouseover", function (event) {
                                const tooltipEl = document.getElementById("globe-tooltip-fixed");
                                tooltipEl.innerHTML = tooltipHtml;
                                tooltipEl.style.display = "block";

                                tooltipEl.style.left = (event.clientX + 15) + "px";
                                tooltipEl.style.top = (event.clientY - 15) + "px";
                            })
                            .on("mousemove", function (event) {
                                const tooltipEl = document.getElementById("globe-tooltip-fixed");
                                tooltipEl.style.left = (event.clientX + 15) + "px";
                                tooltipEl.style.top = (event.clientY - 15) + "px";
                            })
                            .on("mouseout", function () {
                                document.getElementById("globe-tooltip-fixed").style.display = "none";
                            });
                    });

                    // Adiciona malha de fronteiras
                    globeG.append("path")
                        .datum(topojson.mesh(world, world.objects.countries, (a, b) => a !== b))
                        .attr("class", "boundary")
                        .attr("d", globePath);

                    function createLegend() {
                        const legendContent = d3.select("#legendContent");
                        legendContent.html("");

                        // Ordenar categorias por contagem (descendente)
                        const sortedCategories = [...globeCategories].sort((a, b) => b.count - a.count);

                        // Adicionar pa√≠ses com receitas
                        sortedCategories.forEach(cat => {
                            legendContent.append("div")
                                .style("display", "flex")
                                .style("align-items", "center")
                                .style("margin-bottom", "3px")
                                .html(`
                <div style="width:10px; height:10px; min-width:10px; margin-right:4px; border-radius:2px; background:${cat.color}; border:1px solid rgba(0,0,0,0.1);"></div>
                <span style="font-size:10px; line-height:1.2; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${cat.name}</span>
            `);
                        });

                        // Adicionar pa√≠ses sem receitas no final
                        legendContent.append("div")
                            .style("display", "flex")
                            .style("align-items", "center")
                            .style("margin-bottom", "3px")
                            .html(`
            <div style="width:10px; height:10px; min-width:10px; margin-right:4px; border-radius:2px; background:#FFFFFF; border:1px solid rgba(0,0,0,0.1);"></div>
            <span style="font-size:10px; line-height:1.2;">No recipes</span>
        `);
                    }


                    createLegend();

                    // Controles de intera√ß√£o
                    let lastPos = null;

                    function dragstarted(event) {
                        lastPos = [event.x, event.y];
                    }

                    function dragged(event) {
                        if (!lastPos) return;
                        const dx = event.x - lastPos[0];
                        const dy = event.y - lastPos[1];
                        const r = globeProjection.rotate();
                        globeProjection.rotate([
                            r[0] + dx * 0.25,
                            Math.max(-90, Math.min(90, r[1] - dy * 0.25)),
                            r[2]
                        ]);
                        lastPos = [event.x, event.y];
                        globeSvg.selectAll("path").attr("d", globePath);
                    }

                    function dragended() {
                        lastPos = null;
                    }

                    // Usar a fun√ß√£o espec√≠fica para drag em D3v7
                    globeSvg.call(
                        d3.drag()
                            .on("start", dragstarted)
                            .on("drag", dragged)
                            .on("end", dragended)
                    );

                    document.getElementById("zoomIn").addEventListener("click", () => {
                        globeProjection.scale(globeProjection.scale() * 1.3);
                        globeSvg.selectAll("path").attr("d", globePath);
                    });

                    document.getElementById("zoomOut").addEventListener("click", () => {
                        globeProjection.scale(globeProjection.scale() / 1.3);
                        globeSvg.selectAll("path").attr("d", globePath);
                    });

                    document.getElementById("resetView").addEventListener("click", () => {
                        globeProjection.scale(Math.min(globeWidth, globeHeight) * 0.45)
                            .rotate([0, 0, 0]);
                        globeSvg.selectAll("path").attr("d", globePath);
                    });
                });
            </script>

            <!--Clients-->
            <!--End of Clients-->
            <!--Pricing Tables-->
            <!--End of Pricing Tables-->


            <!-- Scripts para visualiza√ß√£o -->
            <script src="https://d3js.org/d3.v4.min.js">
            </script>
            <script>
                var diameter = 960,
                    radius = diameter / 2,
                    innerRadius = radius - 160;

                var cluster = d3.cluster().size([360, innerRadius]);
                var line = d3.radialLine()
                    .curve(d3.curveBundle.beta(0.85))
                    .radius(d => d.y)
                    .angle(d => d.x / 180 * Math.PI);

                var svg = d3.select("#viz").append("svg").attr("viewBox", "0 0 960 960").attr("preserveAspectRatio", "xMidYMid meet")
                    .attr("width", diameter)
                    .attr("height", diameter)
                    .append("g")
                    .attr("transform", `translate(${radius},${radius})`);

                var color = d3.scaleOrdinal()
                    .domain(["", "Meat", "", "", "", ""]) // pastel rainbow: red, orange, yellow, green, blue
                    .range(["#FFB3BA", "#FFDFBA", "#FFFFBA", "#BAFFC9", "#BAE1FF"]); // pastel rainbow: red, orange, yellow, green, blue

                // Load external JSON file
                d3.json("ingredients_bundling.json", function (error, classes) {
                    if (error) {
                        console.error("Error loading JSON data:", error);
                        return;
                    }

                    try {
                        var root = packageHierarchy(classes).sum(d => d.size);
                        cluster(root);

                        var leaves = root.leaves();
                        var nameToNode = {};
                        leaves.forEach(d => nameToNode[d.data.name] = d);

                        var links = packageImports(leaves, nameToNode);

                        svg.append("g").attr("class", "links")
                            .selectAll(".link")
                            .data(links)
                            .enter().append("path")
                            .attr("class", "link")
                            .attr("d", line)
                            .each(d => {
                                d.source = d[0];
                                d.target = d[d.length - 1];
                            });

                        svg.append("g").attr("class", "nodes")
                            .selectAll(".node")
                            .data(leaves)
                            .enter().append("text")
                            .attr("class", "node")
                            .attr("dy", "0.31em")
                            .attr("transform", d => `rotate(${d.x - 90})translate(${d.y + 6},0)` + (d.x < 180 ? "" : "rotate(180)"))
                            .attr("text-anchor", d => d.x < 180 ? "start" : "end")
                            .text(d => d.data.key)
                            .style("fill", d => color(d.data.group))
                            .on("mouseover", mouseovered)
                            .on("mouseout", mouseouted);

                        // Labels de categoria
                        var groupAngles = d3.nest()
                            .key(d => d.data.group)
                            .rollup(v => d3.mean(v, d => d.x))
                            .entries(leaves);

                        svg.append("g")
                            .selectAll(".label-category")
                            .data(groupAngles)
                            .enter().append("text")
                            .attr("class", "label-category")
                            .attr("dy", "0.35em")
                            .attr("transform", d => {
                                const angle = d.value;
                                const r = innerRadius + 40;
                                return `rotate(${angle - 90})translate(${r},0)${angle < 180 ? "" : "rotate(180)"}`;
                            })
                            .attr("text-anchor", d => d.value < 180 ? "start" : "end")
                            .style("font-weight", "bold")
                            .style("fill", "#444")
                            .text(d => d.key);

                        function mouseovered(d) {
                            svg.selectAll(".eb-link")
                                .classed("target", l => l.target === d)
                                .classed("source", l => l.source === d);
                        }

                        function mouseouted() {
                            svg.selectAll(".eb-link").classed("target", false).classed("source", false);
                        }
                    } catch (err) {
                        console.error("Error in bundle visualization:", err);
                    }

                    function packageHierarchy(classes) {
                        var map = {};
                        function find(name, data) {
                            var node = map[name], i;
                            if (!node) {
                                node = map[name] = data || { name: name, children: [] };
                                if (name.length) {
                                    node.parent = find(name.substring(0, i = name.lastIndexOf(".")));
                                    node.parent.children.push(node);
                                    node.key = name.substring(i + 1);
                                }
                            }
                            return node;
                        }
                        classes.forEach(d => find(d.name, d));
                        return d3.hierarchy(map[""]);
                    }

                    function packageImports(nodes, map) {
                        var imports = [];
                        nodes.forEach(d => {
                            if (d.data.imports) d.data.imports.forEach(i => {
                                if (map[i]) imports.push(map[d.data.name].path(map[i]));
                            });
                        });
                        return imports;
                    }
                });
            </script>

            <script>
                // This script has references to undefined variables and functions
                // Commenting out to prevent errors
                /*
                const width = 954;
                const radius = width / 2;
                const k = 6; // 2^k colors segments per curve

                const tree = d3.cluster()
                    .size([2 * Math.PI, radius - 100]);
                const root = tree(bilink(d3.hierarchy(data)
                    .sort((a, b) => d3.ascending(a.height, b.height) || d3.ascending(a.data.name, b.data.name))));

                console.log("Dados carregados:", classes);

                const svg = d3.create("svg")
                    .attr("width", width)
                    .attr("height", width)
                    .attr("viewBox", [-width / 2, -width / 2, width, width])
                    .attr("style", "max-width: 100%; height: auto; font: 10px sans-serif;");

                const chartNode = svg.append("g")
                    .selectAll()
                    .data(root.leaves())
                    .join("g")
                    .attr("transform", d => `rotate(${d.x * 180 / Math.PI - 90}) translate(${d.y},0)`)
                    .append("text")
                    .attr("dy", "0.31em")
                    .attr("x", d => d.x < Math.PI ? 6 : -6)
                    .attr("text-anchor", d => d.x < Math.PI ? "start" : "end")
                    .attr("transform", d => d.x >= Math.PI ? "rotate(180)" : null)
                    .text(d => d.data.name)
                    .call(text => text.append("title").text(d => `${id(d)}\n${d.outgoing.length} outgoing\n${d.incoming.length} incoming`));

                const line = d3.lineRadial()
                    .curve(d3.curveBundle)
                    .radius(d => d.y)
                    .angle(d => d.x);

                const path = ([source, target]) => {
                    const p = new Path;
                    line.context(p)(source.path(target));
                    return p;
                };

                svg.append("g")
                    .attr("fill", "none")
                    .selectAll()
                    .data(d3.transpose(root.leaves()
                        .flatMap(leaf => leaf.outgoing.map(path))
                        .map(path => Array.from(path.split(k)))))
                    .join("path")
                    .style("mix-blend-mode", "darken")
                    .attr("stroke", "#FF0000") // cor fixa para teste
                    .attr("d", d => d.join(""));
                */

                // Console message indicating this code is disabled
                console.log("Radial visualization with external JSON data is disabled due to CORS restrictions when running locally.");
            </script>

            <div id="tooltip"></div>

            <!-- Bubble Chart Visualization Section -->
            <section class="scrollto clearfix" id="bubble-viz-section"
                style="background:#fff; padding:35px 0 80px 0; min-height:650px; margin-bottom: 40px;">

                <!-- Google Open Sans Font -->
                <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800" rel="stylesheet"
                    type="text/css">

                <style>
                    /* Styles from bubbling.html, scoped as much as possible or integrated */
                    /* Ensure body styles from bubbling.html don't override the main page body style */
                    #bubble-viz {
                        /* Scope general styles to this section */
                        background-color: #FFFFFF;
                        font-family: 'Open Sans', sans-serif;
                        padding: 30px;
                        /* This padding is for the outer section */
                        overflow-x: hidden;
                        color: #444;
                    }

                    #bubble-viz .section-heading {
                        text-align: center;
                        margin-bottom: 40px;
                    }

                    #bubble-viz .section-heading h3 {
                        font-size: 16px;
                        color: #888;
                        text-transform: uppercase;
                        margin-bottom: 5px;
                        letter-spacing: 1.5px;
                        font-weight: 600;
                    }

                    #bubble-viz .section-heading h2 {
                        font-size: 32px;
                        margin: 0 0 15px;
                        color: #333;
                        font-weight: 700;
                    }

                    #bubble-viz .section-heading p {
                        color: #666;
                        font-size: 17px;
                        max-width: 800px;
                        margin: 0 auto;
                        line-height: 1.6;
                    }

                    #bubble-viz .visualization-container-bubble {
                        /* Renamed to avoid conflict */
                        display: flex;
                        flex-direction: row;
                        max-width: 1100px;
                        margin: 0 auto;
                        overflow: visible;
                        align-items: flex-start;
                        background-color: #FFFFFF;
                        /* Changed to white */
                        border-radius: 0;
                        /* Removed border-radius */
                        box-shadow: none;
                        /* Removed box-shadow */
                        padding: 0;
                        /* Removed padding */
                    }

                    #bubble-viz #legend-container-bubble {
                        /* Renamed */
                        width: 220px;
                        min-width: 220px;
                        margin-right: 30px;
                        /* Adjusted margin */
                        padding: 20px;
                        background: white;
                        border-radius: 10px;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
                        align-self: flex-start;
                        /* margin-left: -80px; /* Removed this negative margin */
                        border: 1px solid #f0f0f0;
                    }

                    #bubble-viz .legend-title-bubble {
                        /* Renamed */
                        margin-top: 0;
                        margin-bottom: 15px;
                        font-size: 17px;
                        font-weight: bold;
                        font-family: 'Open Sans', sans-serif;
                        color: #333;
                        border-bottom: 2px solid #f0f0f0;
                        padding-bottom: 10px;
                    }

                    #bubble-viz .legend-section-bubble {
                        /* Renamed */
                        margin-bottom: 25px;
                    }

                    #bubble-viz .legend-subtitle-bubble {
                        /* Renamed */
                        font-size: 15px;
                        font-weight: 600;
                        margin-bottom: 10px;
                        color: #555;
                        border-left: 3px solid #ddd;
                        padding-left: 8px;
                    }

                    #bubble-viz .legend-item-bubble {
                        /* Renamed */
                        display: flex;
                        align-items: center;
                        margin-bottom: 12px;
                        padding: 5px;
                        border-radius: 4px;
                        transition: background 0.2s;
                    }

                    #bubble-viz .legend-item-bubble:hover {
                        background: #f9f9f9;
                    }

                    #bubble-viz .color-box-bubble {
                        /* Renamed */
                        width: 22px;
                        height: 22px;
                        margin-right: 12px;
                        border-radius: 4px;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                    }

                    #bubble-viz .border-sample-bubble {
                        /* Renamed */
                        width: 26px;
                        height: 26px;
                        margin-right: 12px;
                        border-radius: 50%;
                        background: #f5f5f5;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
                    }

                    #bubble-viz .border-solid-bubble {
                        /* Renamed */
                        border: 2px solid #333;
                    }

                    #bubble-viz .border-dashed-bubble {
                        /* Renamed */
                        border: 2px dashed #333;
                    }

                    #bubble-viz .border-thick-bubble {
                        /* Renamed */
                        border-width: 1.8px;
                    }

                    #bubble-viz .border-thin-bubble {
                        /* Renamed */
                        border-width: 1px;
                    }

                    #bubble-viz #bubble-container-chart {
                        /* Renamed */
                        flex-grow: 1;
                        /* width: 900px; /* Let it be responsive */
                        height: 750px;
                        /* Adjusted height */
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        /* margin-left: 30px; /* Adjusted */
                        position: relative;
                    }

                    #bubble-viz #tooltip-bubble {
                        /* Renamed */
                        position: absolute;
                        background: rgba(255, 255, 255, 0.98);
                        color: #333;
                        padding: 12px 15px;
                        border-radius: 6px;
                        font-size: 14px;
                        font-family: 'Open Sans', sans-serif;
                        pointer-events: none;
                        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
                        max-width: 280px;
                        line-height: 1.5em;
                        opacity: 0;
                        border: none;
                        z-index: 9999;
                    }

                    #bubble-viz #tooltip-bubble strong {
                        color: #111;
                        font-weight: 600;
                    }

                    #bubble-viz .label-bubble {
                        /* Renamed */
                        font-family: 'Open Sans', sans-serif;
                        text-anchor: middle;
                        pointer-events: none;
                        fill: white;
                        font-weight: 600;
                    }

                    #bubble-viz .node-bubble {
                        /* Renamed */
                        stroke: #fff;
                        stroke-width: 1.5px;
                    }
                </style>

                <div class="section-heading"> <!-- This is from bubbling.html -->
                    <h3>EXPLORE</h3>
                    <h2 style="font-weight:bold">Global Ingredients Hierarchy</h2>
                    <p class="section-subtitle" style="color:#666666">Visualize the
                        most used ingredients by region and culinary category.
                        Click on bubbles to explore in detail.</p>
                </div>

                <div class="visualization-container-bubble" style="position: relative; overflow: visible;">
                    <!-- Removed bubble-container-chart from here to be placed inside bubble-viz -->
                </div>

                <div id="bubble-viz" style="position:relative; background-color: white;">
                    <!-- Bubble chart container moved inside bubble-viz -->
                    <div id="bubble-container-chart"
                        style="position: relative; width: 100%; height: 650px; background-color: white;">
                        <!-- Visualization Guide legend positioned to avoid overlap -->
                        <div class="legend"
                            style="position:absolute; top:20px; right:70px; background:white; padding:12px 14px; border-radius:8px; color:#333; font-size:13px; z-index:10; max-width:230px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-family:'Open Sans', sans-serif;">
                            <h3
                                style="font-size:15px; margin:0 0 10px 0; color:#111; border-bottom:1px solid #eee; padding-bottom:6px;">
                                Visualization Guide
                            </h3>
                            <div style="margin-bottom:10px;">
                                <div style="font-weight:600; font-size:12px; color:#444; margin-bottom:6px;">Bubble
                                    Types</div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#ddd; border:1px solid #eee;"></div>
                                    <span>Region</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#eee; border:2px solid #333;"></div>
                                    <span>Category</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px;">
                                    <div style="width:12px; height:12px; background:#f2f2f2; border:2px dashed #333;">
                                    </div>
                                    <span>Ingredient</span>
                                </div>
                            </div>
                            <div>
                                <div style="font-weight:600; font-size:12px; color:#444; margin-bottom:6px;">Regions
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#8B0000; border:1px solid #eee;">
                                    </div>
                                    <span>Africa</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#B71C1C; border:1px solid #eee;">
                                    </div>
                                    <span>Australia & NZ</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#D32F2F; border:1px solid #eee;">
                                    </div>
                                    <span>British Isles</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#BF360C; border:1px solid #eee;">
                                    </div>
                                    <span>China</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#E65100; border:1px solid #eee;">
                                    </div>
                                    <span>France</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#F57F17; border:1px solid #eee;">
                                    </div>
                                    <span>India</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#FFB300; border:1px solid #eee;">
                                    </div>
                                    <span>Italy</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#B47D49; border:1px solid #eee;">
                                    </div>
                                    <span>Japan</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#7D4E2D; border:1px solid #eee;">
                                    </div>
                                    <span>Korea</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                                    <div style="width:12px; height:12px; background:#C77B30; border:1px solid #eee;">
                                    </div>
                                    <span>Middle East</span>
                                </div>
                                <div style="display:flex; align-items:center; gap:6px;">
                                    <div style="width:12px; height:12px; background:#DAA520; border:1px solid #eee;">
                                    </div>
                                    <span>USA</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add the tooltip inside the existing bubble-viz -->
                    <div id="tooltip-bubble"
                        style="position:absolute; background:rgba(255,255,255,0.98); color:#333; padding:12px 15px; border-radius:6px; font-size:14px; font-family:'Open Sans',sans-serif; pointer-events:none; box-shadow:0 4px 15px rgba(0,0,0,0.15); max-width:280px; line-height:1.5em; opacity:0; border:none; z-index:9999; transition:opacity 0.2s ease-in-out;">
                    </div> <!-- Tooltip container for bubble chart -->
                </div>

                <!-- Include D3.js v6 specifically for this script if needed, otherwise main D3 might work -->
                <script src="https://d3js.org/d3.v6.min.js"></script>

                <script>
                    // Script from bubbling.html, adapted
                    (function () { // Wrap in IIFE to avoid global scope pollution
                        // Wait for DOM to fully load - not strictly necessary if script is at end of section
                        // document.addEventListener("DOMContentLoaded", function () { // Already wrapped by main page's DOMContentLoaded for other scripts

                        // Paleta de cores claras para categorias (Commented out as in original)
                        /*
                        const brightColors = { ... };
                        */

                        const data = {
                            "name": "Cuisine",
                            "children": [
                                {
                                    "name": "Africa",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 365 },
                                                { "name": "Water", "value": 241 }
                                            ]
                                        },
                                        {
                                            "name": "Herb",
                                            "children": [
                                                { "name": "Garlic", "value": 334 }
                                            ]
                                        },
                                        {
                                            "name": "Meat",
                                            "children": [
                                                { "name": "Chicken", "value": 234 }
                                            ]
                                        },
                                        {
                                            "name": "Plant",
                                            "children": [
                                                { "name": "Olive", "value": 461 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Cinnamon", "value": 209 },
                                                { "name": "Cumin", "value": 264 },
                                                { "name": "Pepper", "value": 351 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 341 },
                                                { "name": "Tomato", "value": 182 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "Australia & NZ",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 117 },
                                                { "name": "Sugar", "value": 152 },
                                                { "name": "Water", "value": 156 }
                                            ]
                                        },
                                        {
                                            "name": "Dairy",
                                            "children": [
                                                { "name": "Butter", "value": 115 }
                                            ]
                                        },
                                        {
                                            "name": "Herb",
                                            "children": [
                                                { "name": "Garlic", "value": 106 }
                                            ]
                                        },
                                        {
                                            "name": "Plant",
                                            "children": [
                                                { "name": "Olive", "value": 105 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Pepper", "value": 171 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 184 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "British Isles",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 276 },
                                                { "name": "Sugar", "value": 280 },
                                                { "name": "Water", "value": 165 }
                                            ]
                                        },
                                        {
                                            "name": "Dairy",
                                            "children": [
                                                { "name": "Butter", "value": 268 }
                                            ]
                                        },
                                        {
                                            "name": "Herb",
                                            "children": [
                                                { "name": "Garlic", "value": 156 }
                                            ]
                                        },
                                        {
                                            "name": "Plant",
                                            "children": [
                                                { "name": "Olive", "value": 157 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Pepper", "value": 247 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 263 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "China",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 435 },
                                                { "name": "Sugar", "value": 477 },
                                                { "name": "Water", "value": 392 },
                                                { "name": "Soy Sauce", "value": 707 },
                                                { "name": "Vegetable Oil", "value": 353 }
                                            ]
                                        },
                                        {
                                            "name": "Cereal",
                                            "children": [
                                                { "name": "Cornstarch", "value": 314 }
                                            ]
                                        },
                                        {
                                            "name": "Meat",
                                            "children": [
                                                { "name": "Chicken", "value": 373 }
                                            ]
                                        },
                                        {
                                            "name": "Nuts & Seed",
                                            "children": [
                                                { "name": "Sesame", "value": 497 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Ginger", "value": 532 },
                                                { "name": "Pepper", "value": 521 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Garlic", "value": 526 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "France",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 314 },
                                                { "name": "Sugar", "value": 270 },
                                                { "name": "Water", "value": 210 }
                                            ]
                                        },
                                        {
                                            "name": "Dairy",
                                            "children": [
                                                { "name": "Butter", "value": 277 }
                                            ]
                                        },
                                        {
                                            "name": "Herb",
                                            "children": [
                                                { "name": "Garlic", "value": 206 }
                                            ]
                                        },
                                        {
                                            "name": "Plant",
                                            "children": [
                                                { "name": "Olive", "value": 228 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Pepper", "value": 236 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 232 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "India",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 1242 },
                                                { "name": "Sugar", "value": 1060 },
                                                { "name": "Water", "value": 1018 }
                                            ]
                                        },
                                        {
                                            "name": "Meat",
                                            "children": [
                                                { "name": "Chicken", "value": 568 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Cumin", "value": 549 },
                                                { "name": "Garlic", "value": 540 },
                                                { "name": "Pepper", "value": 492 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 593 },
                                                { "name": "Tomato", "value": 444 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "Italy",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 623 },
                                                { "name": "Sugar", "value": 381 },
                                                { "name": "Water", "value": 363 }
                                            ]
                                        },
                                        {
                                            "name": "Dairy",
                                            "children": [
                                                { "name": "Butter", "value": 289 }
                                            ]
                                        },
                                        {
                                            "name": "Herb",
                                            "children": [
                                                { "name": "Garlic", "value": 373 }
                                            ]
                                        },
                                        {
                                            "name": "Plant",
                                            "children": [
                                                { "name": "Olive", "value": 349 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Pepper", "value": 362 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 331 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "Japan",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 214 },
                                                { "name": "Sugar", "value": 194 },
                                                { "name": "Water", "value": 170 }
                                            ]
                                        },
                                        {
                                            "name": "Meat",
                                            "children": [
                                                { "name": "Chicken", "value": 149 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Garlic", "value": 129 },
                                                { "name": "Pepper", "value": 135 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 133 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "Korea",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 276 },
                                                { "name": "Sugar", "value": 272 },
                                                { "name": "Water", "value": 200 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Garlic", "value": 245 },
                                                { "name": "Pepper", "value": 210 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 227 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "Middle East",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 632 },
                                                { "name": "Sugar", "value": 237 },
                                                { "name": "Water", "value": 418 }
                                            ]
                                        },
                                        {
                                            "name": "Beverage",
                                            "children": [
                                                { "name": "Lemon Juice", "value": 326 }
                                            ]
                                        },
                                        {
                                            "name": "Herb",
                                            "children": [
                                                { "name": "Parsley", "value": 294 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Cumin", "value": 264 },
                                                { "name": "Garlic", "value": 553 },
                                                { "name": "Pepper", "value": 521 }
                                            ]
                                        },
                                        {
                                            "name": "Plant",
                                            "children": [
                                                { "name": "Olive", "value": 623 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 420 }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "USA",
                                    "children": [
                                        {
                                            "name": "Additive",
                                            "children": [
                                                { "name": "Salt", "value": 8280 },
                                                { "name": "Sugar", "value": 7916 },
                                                { "name": "Water", "value": 3490 }
                                            ]
                                        },
                                        {
                                            "name": "Bakery",
                                            "children": [
                                                { "name": "Flour", "value": 4047 }
                                            ]
                                        },
                                        {
                                            "name": "Dairy",
                                            "children": [
                                                { "name": "Butter", "value": 6831 }
                                            ]
                                        },
                                        {
                                            "name": "Herb",
                                            "children": [
                                                { "name": "Garlic", "value": 5235 }
                                            ]
                                        },
                                        {
                                            "name": "Meat",
                                            "children": [
                                                { "name": "Egg", "value": 4748 }
                                            ]
                                        },
                                        {
                                            "name": "Plant",
                                            "children": [
                                                { "name": "Olive", "value": 4668 }
                                            ]
                                        },
                                        {
                                            "name": "Spice",
                                            "children": [
                                                { "name": "Pepper", "value": 7611 }
                                            ]
                                        },
                                        {
                                            "name": "Vegetable",
                                            "children": [
                                                { "name": "Onion", "value": 5188 }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        };



                        // Ensure D3 is available (prefer window.d3 if v6 is needed and loaded, else use global d3)
                        const d3 = window.d3; // Assuming D3 v6 is loaded globally if the specific script tag is used, or v7 from main page

                        createBubbleChart(data);

                        function createBubbleChart(chartData) { // Renamed arg from data to chartData
                            const width = 750; // Reduced from 850
                            const height = 650; // Reduced from 750
                            const margin = 25; // Reduced from 30

                            // Diverse warm color palette with greater visual variety
                            const diverseWarmPalette = [
                                "#8B0000", // Deep Maroon
                                "#B71C1C", // Dark Red
                                "#D32F2F", // Bright Red
                                "#BF360C", // Brick Red/Rust
                                "#E65100", // Burnt Orange
                                "#F57F17", // Deep Amber
                                "#FFB300", // Amber/Gold
                                "#B47D49", // Bronze
                                "#7D4E2D", // Warm Brown
                                "#C77B30", // Copper
                                "#DAA520"  // Goldenrod
                            ];

                            // Alphabetical list of regions (must match static legend order and data keys)
                            const alphabeticalRegions = ["Africa", "Australia & NZ", "British Isles", "China", "France", "India", "Italy", "Japan", "Korea", "Middle East", "USA"];

                            const regionColors = {};
                            alphabeticalRegions.forEach((region, index) => {
                                // Direct assignment since we have 11 colors for 11 regions
                                regionColors[region] = diverseWarmPalette[index];
                            });

                            // const legendContainer = d3.select("#bubble-viz #legend-items-bubble"); // Scoped selector - No longer needed for static legend
                            // legendContainer.html(""); // THIS LINE IS THE CULPRIT - REMOVE/COMMENT OUT
                            // d3.select("#bubble-viz .legend-title-bubble").text("Visualization Guide"); // Dynamic title setting removed

                            const svg = d3.select("#bubble-viz #bubble-container-chart") // Scoped selector
                                .append("svg")
                                .attr("width", "100%")
                                .attr("height", "100%")
                                .attr("viewBox", `0 0 ${width} ${height}`)
                                .attr("preserveAspectRatio", "xMidYMid meet")
                                .style("display", "block").style("margin", "0 auto").style("cursor", "pointer").style("overflow", "visible");

                            const defs = svg.append("defs");
                            const filter = defs.append("filter").attr("id", "drop-shadow-bubble").attr("height", "130%"); // Renamed filter ID
                            filter.append("feGaussianBlur").attr("in", "SourceAlpha").attr("stdDeviation", 4).attr("result", "blur");
                            filter.append("feOffset").attr("in", "blur").attr("dx", 2).attr("dy", 2).attr("result", "offsetBlur");
                            const feComponentTransfer = filter.append("feComponentTransfer").attr("in", "offsetBlur").attr("result", "offsetBlur");
                            feComponentTransfer.append("feFuncA").attr("type", "linear").attr("slope", 0.3);
                            const feMerge = filter.append("feMerge");
                            feMerge.append("feMergeNode").attr("in", "offsetBlur");
                            feMerge.append("feMergeNode").attr("in", "SourceGraphic");

                            const g = svg.append("g").attr("transform", `translate(${width / 2}, ${height / 2})`);
                            const root = d3.hierarchy(chartData).sum(d => d.value).sort((a, b) => b.value - a.value);
                            const pack = d3.pack().size([width - margin * 2, height - margin * 2]).padding(10); // Reduced padding for smaller visualization
                            pack(root);

                            // Make ingredient bubbles larger in non-USA regions
                            root.descendants().forEach(node => {
                                // Only target ingredient nodes (depth 3) that are NOT in USA
                                if (node.depth === 3 &&
                                    node.parent && node.parent.parent &&
                                    node.parent.parent.data.name !== "USA") {

                                    // Make non-USA ingredients larger
                                    node.r = node.r * 1.25; // 25% larger
                                }
                            });

                            // Find USA node and move it to the center
                            // const usaNode = root.descendants().find(d => d.data.name === "USA" && d.depth === 1);

                            // Vari√°vel para manter o controle do n√≥ atual em foco
                            let focus = root;

                            let view;

                            function getNodeFillColor(d, currentFocusNode) {
                                if (d.depth === 0) return "white";
                                let ancestralRegion = d;
                                while (ancestralRegion.depth > 1 && ancestralRegion.parent) ancestralRegion = ancestralRegion.parent;
                                const baseColorString = regionColors[ancestralRegion.data.name] || "#CCCCCC";
                                if (d.depth === 1) return d3.rgb(baseColorString).darker(0.7).toString();
                                else if (d.depth === 2) return baseColorString;
                                else if (d.depth === 3) return d3.rgb(baseColorString).brighter(0.7).toString();
                                return "#e0e0e0";
                            }

                            function getNodeStrokeColor(d, currentFocusNode) {
                                if (d.depth === 0) return "#000000";
                                if (d === currentFocusNode && d.depth > 0) return "#000000";
                                return "#fff";
                            }

                            const tooltip = d3.select("#bubble-viz #tooltip-bubble"); // Scoped selector

                            const circle = g.selectAll("circle")
                                .data(root.descendants())
                                .join("circle")
                                .attr("class", d => d.children ? "node-bubble" : "node-bubble node--leaf-bubble") // Added -bubble suffix
                                .attr("fill", d => getNodeFillColor(d, focus))
                                .attr("opacity", 0.95)
                                .attr("stroke", d => getNodeStrokeColor(d, focus))
                                .attr("stroke-width", d => (d.depth === 0) ? 2.5 : (d.depth === 1) ? 1.5 : (d.depth === 2) ? 1.8 : 1)
                                .attr("stroke-dasharray", d => (d.depth === 3) ? "4,2" : "none")
                                .attr("filter", d => d.depth === 0 ? "url(#drop-shadow-bubble)" : "none") // Use renamed filter ID
                                .on("mouseover", function (event, d) {
                                    let content = `
                                      <div style=\"text-align: center; border-bottom: 1px solid #eee; padding-bottom: 4px; margin-bottom: 4px;\">
                                        <strong style=\"font-size: 16px; color: #222;\">${d.data.name}</strong>
                                      </div>
                                      <div style=\"font-size: 15px; color: #888;\">
                                        ${d.depth === 1 ? `Total usage: ${d.value.toLocaleString()}` : ""}
                                        ${d.depth === 2 ? `Region: ${d.parent.data.name}<br>Total usage: ${d.value.toLocaleString()}` : ""}
                                        ${d.depth === 3 ? `Category: ${d.parent.data.name}<br>Region: ${d.parent.parent.data.name}<br>Usage count: ${d.data.value.toLocaleString()}` : ""}
                                      </div>
                                    `;
                                    showTooltip(event, content);
                                    d3.select(this).style("opacity", 1)
                                        .style("stroke-width", (d.depth === 0) ? 3.5 : (d.depth === 1) ? 2.5 : (d.depth === 2) ? 3.5 : 2.5);
                                })
                                .on("mouseout", function (event, d_node) {
                                    hideTooltip();
                                    d3.select(this).style("opacity", 0.95)
                                        .style("stroke-width", (d_node.depth === 0) ? 2.5 : (d_node.depth === 1) ? 1.5 : (d_node.depth === 2) ? 1.8 : 1);
                                })
                                .on("click", (event, d_node) => { // Added d_node
                                    if (focus !== d_node) { zoom(d_node); event.stopPropagation(); }
                                });

                            const labelGroup = g.selectAll(".label-group-bubble") // Added -bubble suffix
                                .data(root.descendants().filter(d => d.data.name && d.depth >= 1))
                                .join("g")
                                .attr("class", "label-group-bubble") // Added -bubble suffix
                                .style("fill-opacity", dLabel => ((focus === root && dLabel.depth === 1) || (dLabel.parent === focus && dLabel.depth > 1)) ? 1 : 0)
                                .style("display", dLabel => ((focus === root && dLabel.depth === 1) || (dLabel.parent === focus && dLabel.depth > 1)) ? "inline" : "none")
                                .attr("pointer-events", "none");

                            labelGroup.each(function (dNode) {
                                const group = d3.select(this);
                                const name = dNode.data.name;
                                let fontSize, fontWeight, fillColor, yPosition, dominantBaseline;

                                if (dNode.depth === 1) {
                                    fontSize = "10px"; fontWeight = "600"; fillColor = "#333"; yPosition = -dNode.r - 3; dominantBaseline = "text-after-edge";
                                } else {
                                    fontSize = dNode.depth === 2 ? "11px" : "9px"; fontWeight = dNode.depth === 2 ? "600" : "normal";
                                    const regionName = dNode.depth === 2 ? dNode.parent.data.name : dNode.parent.parent.data.name;
                                    fillColor = (regionName === "China") ? "#000000" : "white";
                                    yPosition = 0; dominantBaseline = "middle";
                                }
                                const textElement = group.append("text").attr("class", "label-bubble").attr("y", yPosition) // Added -bubble suffix
                                    .style("font-size", fontSize).style("font-weight", fontWeight).style("fill", fillColor).style("dominant-baseline", dominantBaseline).text(name);
                                if (dNode.depth === 1) {
                                    const textNode = textElement.node();
                                    if (textNode) {
                                        const bbox = textNode.getBBox(); const padding = 3;
                                        // The following lines that create the rectangle are now restored:
                                        group.insert("rect", "text.label-bubble").attr("class", "label-background-bubble") // Added -bubble suffix
                                            .attr("x", bbox.x - padding).attr("y", bbox.y - padding).attr("width", bbox.width + padding * 2).attr("height", bbox.height + padding * 2)
                                            .attr("rx", 3).attr("ry", 3).style("fill", "white").style("stroke", "#cccccc").style("stroke-width", "0.5px");
                                    }
                                }
                            });

                            // Removed regionFocusTitle as it was hidden and might conflict
                            svg.on("click", () => zoom(root));
                            zoomTo([root.x, root.y, root.r * 2]);

                            function zoom(dFocus) {
                                focus = dFocus;
                                const transition = svg.transition().duration(750).tween("zoom", () => {
                                    const i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r * 2]);
                                    return t => zoomTo(i(t));
                                });
                                circle.transition(transition).attr("fill", d => getNodeFillColor(d, focus)).attr("stroke", d => getNodeStrokeColor(d, focus));
                                labelGroup.transition(transition)
                                    .style("fill-opacity", dLabel => ((focus === root && dLabel.depth === 1) || (dLabel.parent === focus && dLabel.depth > 1)) ? 1 : 0)
                                    .on("start", function (dLabel) { if ((focus === root && dLabel.depth === 1) || (dLabel.parent === focus && dLabel.depth > 1)) this.style.display = "inline"; })
                                    .on("end", function (dLabel) { if (!((focus === root && dLabel.depth === 1) || (dLabel.parent === focus && dLabel.depth > 1))) this.style.display = "none"; });
                            }

                            function zoomTo(v) {
                                const k = Math.min(width, height) / v[2]; view = v;
                                circle.attr("transform", d => `translate(${(d.x - v[0]) * k},${(d.y - v[1]) * k})`).attr("r", d => d.r * k);
                                labelGroup.attr("transform", d => `translate(${(d.x - v[0]) * k},${(d.y - v[1]) * k})`);
                            }
                        }
                        // }); // End of original DOMContentLoaded from bubbling.html
                    })(); // End of IIFE
                </script>
            </section>
            <!-- End of Bubble Chart Visualization Section -->

            <div id="tooltip"></div>

            <!--Interactive Map-->

            <section id="radial-chart-section" class="color-section flex-container scrollto clearfix"
                style="background:#ffffff; padding:60px 0; margin-top:40px;">
                <div class="row clearfix">
                    <div class="section-heading"
                        style="text-align: center; max-width: 900px; margin: 0 auto 30px auto;">
                        <h3 style="color:#888">EXPLORE</h3>
                        <h2 class="section-title" style="color:#333333">Cuisine Ingredients Connections</h2>
                        <p class="section-subtitle" style="color:#666666">
                            Discover the relationships between different ingredient types across various cuisines.
                            See how ingredients connect and influence each other in global cooking traditions.
                        </p>
                    </div>

                    <div
                        style="display: flex; width: 100%; max-width: 1200px; margin: 0 auto; gap: 20px; flex-direction: column; align-items: center; justify-content: center;">
                        <!-- Dropdown -->
                        <div style="width: 100%; text-align: center; margin-bottom: 30px;">
                            <label for="regionDropdown"
                                style="font-weight: 600; margin-right: 10px; color: #444;">Select
                                Region:</label>
                            <select id="regionDropdown"
                                style="font-size: 16px; padding: 8px 16px; border: 1px solid #ddd; border-radius: 4px; background-color: white; cursor: pointer; width: 250px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);"></select>
                        </div>

                        <!-- Visualiza√ß√£o -->
                        <div
                            style="display: flex; width: 100%; height: 80vh; max-height: 700px; justify-content: center; position: relative;">
                            <!-- Painel lateral esquerdo -->
                            <div
                                style="position:absolute; top:20px; left:20px; background:white; padding:10px 14px; border-radius:5px; color:#333; font-size:13px; z-index:10; max-width:200px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                <h3
                                    style="font-size:16px; margin:0 0 6px 0; color:#111; border-bottom:1px solid #eee; padding-bottom:4px;">
                                    Node Details</h3>
                                <div id="radial-info-panel"><em>Click on a node to see details</em></div>
                            </div>

                            <!-- Gr√°fico -->
                            <div
                                style="flex: 1; position: relative; display: flex; justify-content: center; align-items: center; max-width: 70%;">
                                <svg id="radial-chart" viewBox="-375 -375 750 750"
                                    style="width: 100%; height: 100%; display: block; margin: 0 auto; overflow: visible;"></svg>
                                <div id="radial-tooltip"
                                    style="position: absolute; text-align: center; padding: 8px 12px; background: white; border: 1px solid #ccc; border-radius: 4px; pointer-events: none; font-size: 13px; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); opacity: 0;">
                                </div>
                            </div>

                            <!-- Legenda -->
                            <div
                                style="position: absolute; top: 20px; right: 20px; background: white; padding: 14px; border-radius: 8px; color: #333; font-size: 12px; z-index: 10; max-width: 200px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                <h3
                                    style="margin-top:0; font-size:18px; font-weight:600; color:#111; border-bottom:1px solid #eee; padding-bottom:6px;">
                                    Ingredient Categories
                                </h3>
                                <div id="radial-legend"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <script src="https://d3js.org/d3.v7.min.js"></script>
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const svg = d3.select("#radial-chart");
                    const infoPanel = d3.select("#radial-info-panel");
                    const legend = d3.select("#radial-legend");
                    const dropdown = d3.select("#regionDropdown");
                    const tooltip = d3.select("#radial-tooltip");

                    let selected = null;

                    const categoryColors = {
                        "Additive": "#B0BEC5", "Vegetable": "#4CAF50", "Spice": "#E53935", "Dairy": "#FFD54F",
                        "Fruit": "#F44336", "Plant": "#81C784", "Meat": "#A0522D", "Herb": "#43A047",
                        "Cereal": "#FBC02D", "Nuts & Seed": "#A1887F", "Beverage Alcoholic": "#880E4F",
                        "Beverage": "#FF7043", "Bakery": "#FFB74D", "Seafood": "#FF8A65", "Maize": "#FFEB3B",
                        "Fungus": "#e74c3c", "Fish": "#2196F3", "Essential Oil": "#B3E5FC", "Flower": "#FDD835"
                    };

                    fetch("radial_ingredient_networks.json")
                        .then(res => res.json())
                        .then(data => {
                            const regions = Object.keys(data);
                            dropdown.selectAll("option")
                                .data(regions)
                                .join("option")
                                .text(d => d);

                            dropdown.on("change", () => render(dropdown.node().value));
                            render(regions[0]);

                            function render(region) {
                                let nodes = data[region].nodes;
                                const links = data[region].links;

                                nodes = nodes.sort((a, b) => b.count - a.count);

                                const angleStep = (2 * Math.PI) / nodes.length;
                                const radius = 280;
                                nodes.forEach((d, i) => {
                                    d.x = radius * Math.cos(i * angleStep - Math.PI / 2);
                                    d.y = radius * Math.sin(i * angleStep - Math.PI / 2);
                                });

                                svg.selectAll("*").remove();
                                tooltip.style("opacity", 0);



                                infoPanel.html("<em>Click on a node to see details</em>");

                                const radiusScale = d3.scaleSqrt().domain([1, d3.max(nodes, d => d.count)]).range([5, 20]);
                                const nodeMap = new Map(nodes.map(d => [d.id, d]));
                                const linkScale = d3.scaleLinear().domain([1, d3.max(links, d => d.count)]).range([0.5, 2]);

                                const g = svg.append("g");

                                g.selectAll("line")
                                    .data(links)
                                    .join("line")
                                    .attr("x1", d => nodeMap.get(d.source).x)
                                    .attr("y1", d => nodeMap.get(d.source).y)
                                    .attr("x2", d => nodeMap.get(d.target).x)
                                    .attr("y2", d => nodeMap.get(d.target).y)
                                    .attr("stroke", "#E57373") // vermelho claro
                                    .attr("stroke-width", d => linkScale(d.count))
                                    .attr("stroke-opacity", 0.2)
                                    .attr("class", "link");

                                const node = g.selectAll("g")
                                    .data(nodes)
                                    .join("g")
                                    .attr("transform", d => `translate(${d.x},${d.y})`)
                                    .on("mouseover", function (event, d) {
                                        tooltip.transition().duration(200).style("opacity", 0.9);
                                        tooltip.html(`<strong>${d.emoji || ""} ${d.label}</strong>`)
                                            .style("left", (event.pageX + 10) + "px")
                                            .style("top", (event.pageY - 28) + "px");

                                        d3.select(this).select("circle")
                                            .attr("stroke", "#D32F2F")
                                            .attr("stroke-width", 2);
                                    })
                                    .on("mouseout", function () {
                                        tooltip.transition().duration(200).style("opacity", 0);
                                        d3.select(this).select("circle")
                                            .attr("stroke", "#fff")
                                            .attr("stroke-width", 0.5);
                                    })
                                    .on("click", function (event, d) {
                                        if (selected && selected.id === d.id) {
                                            selected = null;
                                            render(region);
                                            return;
                                        }
                                        selected = d;

                                        const connected = new Set();
                                        links.forEach(l => {
                                            if (l.source === d.id) connected.add(l.target);
                                            if (l.target === d.id) connected.add(l.source);
                                        });

                                        g.selectAll(".link")
                                            .attr("stroke-opacity", l => l.source === d.id || l.target === d.id ? 0.8 : 0.05)
                                            .attr("stroke", l => l.source === d.id || l.target === d.id ? "#D32F2F" : "#E57373");

                                        node.selectAll("circle")
                                            .attr("opacity", n => n.id === d.id || connected.has(n.id) ? 1 : 0.1);

                                        const sortedLinks = links
                                            .filter(l => l.source === d.id || l.target === d.id)
                                            .sort((a, b) => b.count - a.count);

                                        infoPanel.html(`
              <div style="text-align:center;">
                <div style="font-size:24px;">${d.emoji || ""}</div>
                <div style="font-weight:600; font-size:16px;">${d.label}</div>
                <div style="font-size:13px; color:#777;">Used in: <strong>${d.count.toLocaleString()}</strong> recipes</div>
              </div>
              <div style="margin-top:10px; font-size:13px;"><strong>Top co-occurrences:</strong></div>
              <ul style="font-size:13px; padding-left:16px; margin-top:6px;">
                ${sortedLinks.map(l => {
                                            const other = l.source === d.id ? l.target : l.source;
                                            const o = nodeMap.get(other);
                                            return `<li>${o?.emoji || ""} ${o?.label || other} <span style="float:right;">(${l.count.toLocaleString()})</span></li>`;
                                        }).slice(0, 10).join("")}
              </ul>
            `);
                                    });

                                node.append("circle")
                                    .attr("r", d => radiusScale(d.count))
                                    .attr("fill", d => categoryColors[d.id] || "#ccc")
                                    .attr("stroke", "#fff")
                                    .attr("stroke-width", 0.5);

                                svg.selectAll(".emoji-label")
                                    .data(nodes)
                                    .join("text")
                                    .attr("class", "emoji-label")
                                    .attr("x", d => {
                                        const dx = d.x, dy = d.y;
                                        const dist = Math.sqrt(dx * dx + dy * dy);
                                        const offset = radiusScale(d.count) + 16;
                                        return (dx / dist) * (dist + offset);
                                    })
                                    .attr("y", d => {
                                        const dx = d.x, dy = d.y;
                                        const dist = Math.sqrt(dx * dx + dy * dy);
                                        const offset = radiusScale(d.count) + 16;
                                        return (dy / dist) * (dist + offset);
                                    })
                                    .attr("text-anchor", "middle")
                                    .attr("dominant-baseline", "central")
                                    .attr("font-size", "20px")
                                    .style("pointer-events", "none")
                                    .text(d => d.emoji || "");

                                legend.html(`
          <div style="display: flex; flex-direction: column; gap: 6px;">
            ${nodes.slice().sort((a, b) => b.count - a.count).map(d => `
              <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #333;">
                <div style="width: 12px; height: 12px; background: ${categoryColors[d.id] || "#ccc"}; border-radius: 2px;"></div>
                <div style="display: flex; align-items: center; gap: 6px;">
                  <span style="font-size: 16px;">${d.emoji || ""}</span>
                  <span>${d.label}</span>
                </div>
              </div>
            `).join("")}
          </div>
        `);
                            }
                        });
                });
            </script>



            <!--Team-->
            <section class="introduction scrollto text-center" id="team-section"
                style="margin-top: 60px; margin-bottom: 60px; padding-top: 40px;">
                <div class="section-heading">
                    <h2 class="section-title">TEAM</h2>
                    <p class="section-subtitle">Success through collaboration</p>
                </div>
                <div class="team-members-container"
                    style="display: flex; justify-content: center; align-items: flex-start; gap: 64px; flex-wrap: nowrap; margin-top: 32px;">
                    <!-- Membro 1 -->
                    <div class="col-3 testimonial classic" style="margin:0; padding:0; width:auto;">
                        <div
                            style="width: 120px; height: 120px; overflow: hidden; border-radius: 50%; margin-bottom: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: 3px solid white;">
                            <img alt="B√°rbara Peres" src="images/user-images/user-1.jpg"
                                style="width: 100%; height: 100%; object-fit: cover; object-position: center center;" />
                        </div>
                        <p><strong>B√°rbara Peres</strong><br><em style="color:#888">20240349</em><br>
                            <a href="https://www.linkedin.com/in/barbaramperes/" target="_blank"
                                style="display:inline-block;margin-top:6px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="#000">
                                    <path
                                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-10h3v10zm-1.5-11.268c-.966 0-1.75-.784-1.75-1.75s.784-1.75 1.75-1.75 1.75.784 1.75 1.75-.784 1.75-1.75 1.75zm13.5 11.268h-3v-5.604c0-1.337-.025-3.063-1.868-3.063-1.868 0-2.154 1.459-2.154 2.968v5.699h-3v-10h2.881v1.367h.041c.401-.761 1.379-1.563 2.838-1.563 3.036 0 3.597 2.001 3.597 4.601v5.595z" />
                                </svg>
                            </a>
                        </p>
                    </div>
                    <!-- Membro 2 -->
                    <div class="col-3 testimonial classic" style="margin:0; padding:0; width:auto;">
                        <div
                            style="width: 120px; height: 120px; overflow: hidden; border-radius: 50%; margin-bottom: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: 3px solid white;">
                            <img alt="Christian Gon√ßalves" src="images/user-images/user-2.jpg"
                                style="width: 100%; height: 100%; object-fit: cover; object-position: center center;" />
                        </div>
                        <p><strong>Christian Gon√ßalves</strong><br><em style="color:#888">20240011</em><br>
                            <a href="https://www.linkedin.com/in/cmpg/" target="_blank"
                                style="display:inline-block;margin-top:6px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="#000">
                                    <path
                                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-10h3v10zm-1.5-11.268c-.966 0-1.75-.784-1.75-1.75s.784-1.75 1.75-1.75 1.75.784 1.75 1.75-.784 1.75-1.75 1.75zm13.5 11.268h-3v-5.604c0-1.337-.025-3.063-1.868-3.063-1.868 0-2.154 1.459-2.154 2.968v5.699h-3v-10h2.881v1.367h.041c.401-.761 1.379-1.563 2.838-1.563 3.036 0 3.597 2.001 3.597 4.601v5.595z" />
                                </svg>
                            </a>
                        </p>
                    </div>
                    <!-- Membro 3 -->
                    <div class="col-3 testimonial classic" style="margin:0; padding:0; width:auto;">
                        <div
                            style="width: 120px; height: 120px; overflow: hidden; border-radius: 50%; margin-bottom: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: 3px solid white;">
                            <img alt="Diogo Silva" src="images/user-images/user-3.jpg"
                                style="width: 100%; height: 100%; object-fit: cover; object-position: center center;" />
                        </div>
                        <p><strong>Diogo Silva</strong><br><em style="color:#888">20240441</em><br>
                            <a href="https://www.linkedin.com/in/diogo-beltr%C3%A3o-da-silva-5a9811275/" target="_blank"
                                style="display:inline-block;margin-top:6px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="#000">
                                    <path
                                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-10h3v10zm-1.5-11.268c-.966 0-1.75-.784-1.75-1.75s.784-1.75 1.75-1.75 1.75.784 1.75 1.75-.784 1.75-1.75 1.75zm13.5 11.268h-3v-5.604c0-1.337-.025-3.063-1.868-3.063-1.868 0-2.154 1.459-2.154 2.968v5.699h-3v-10h2.881v1.367h.041c.401-.761 1.379-1.563 2.838-1.563 3.036 0 3.597 2.001 3.597 4.601v5.595z" />
                                </svg>
                            </a>
                        </p>
                    </div>
                    <!-- Membro 4 -->
                    <div class="col-3 testimonial classic" style="margin:0; padding:0; width:auto;">
                        <div
                            style="width: 120px; height: 120px; overflow: hidden; border-radius: 50%; margin-bottom: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border: 3px solid white;">
                            <img alt="Leonor Santos" src="images/user-images/user-4.jpg"
                                style="width: 100%; height: 100%; object-fit: cover; object-position: center center;" />
                        </div>
                        <p><strong>Leonor Santos</strong><br><em style="color:#888">20240445</em><br>
                            <a href="https://www.linkedin.com/in/leonorcastelaosantos/" target="_blank"
                                style="display:inline-block;margin-top:6px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="#000">
                                    <path
                                        d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-10h3v10zm-1.5-11.268c-.966 0-1.75-.784-1.75-1.75s.784-1.75 1.75-1.75 1.75.784 1.75 1.75-.784 1.75-1.75 1.75zm13.5 11.268h-3v-5.604c0-1.337-.025-3.063-1.868-3.063-1.868 0-2.154 1.459-2.154 2.968v5.699h-3v-10h2.881v1.367h.041c.401-.761 1.379-1.563 2.838-1.563 3.036 0 3.597 2.001 3.597 4.601v5.595z" />
                                </svg>
                            </a>
                        </p>
                    </div>
                </div>
            </section>
            <!--End Main Content Area-->
            <!--Footer-->
            <footer id="landing-footer" class="clearfix"
                style="background-color: #000000; color: white; padding: 40px 0 30px; text-align: center; font-family: 'Open Sans', sans-serif; position: relative; overflow: hidden;">

                <div class="row clearfix" style="max-width: 960px; margin: 0 auto; position: relative; z-index: 2;">
                    <div
                        style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 30px;">
                        <!-- Logo and description section -->
                        <div style="flex: 1; min-width: 280px; margin: 10px; text-align: left;">
                            <h3
                                style="font-size: 24px; margin-bottom: 15px; color: #ffffff; font-weight: 600; letter-spacing: 1px;">
                                Culinaviz</h3>
                            <div style="width: 50px; height: 3px; background: #e74c3c; margin-bottom: 15px;"></div>
                            <p style="font-size: 14px; line-height: 1.6; color: #ffffff; margin-bottom: 20px;">
                                Exploring
                                global culinary traditions through interactive visualizations.</p>
                        </div>

                        <!-- Contact section -->
                        <div style="flex: 1; min-width: 280px; margin: 10px; text-align: left;">
                            <h4 style="font-size: 18px; margin-bottom: 15px; color: #ffffff; font-weight: 600;">
                                Contact
                                Us</h4>
                            <div style="width: 50px; height: 3px; background: #e74c3c; margin-bottom: 15px;"></div>
                            <p style="font-size: 14px; line-height: 1.6; color: #ffffff; margin-bottom: 10px;">
                                <strong>Universidade NOVA de Lisboa</strong>
                            </p>

                            <!-- Styled email list -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                                <a href="mailto:20240349@novaims.unl.pt"
                                    style="color: #ffffff; text-decoration: none; padding: 8px 10px; background-color: #e74c3c; border-radius: 4px; transition: all 0.3s ease; display: block; font-size: 13px; border: 1px solid #e74c3c;">
                                    <span
                                        style="display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">20240349@novaims.unl.pt</span>
                                </a>
                                <a href="mailto:20240011@novaims.unl.pt"
                                    style="color: #ffffff; text-decoration: none; padding: 8px 10px; background-color: #e74c3c; border-radius: 4px; transition: all 0.3s ease; display: block; font-size: 13px; border: 1px solid #e74c3c;">
                                    <span
                                        style="display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">20240011@novaims.unl.pt</span>
                                </a>
                                <a href="mailto:20240441@novaims.unl.pt"
                                    style="color: #ffffff; text-decoration: none; padding: 8px 10px; background-color: #e74c3c; border-radius: 4px; transition: all 0.3s ease; display: block; font-size: 13px; border: 1px solid #e74c3c;">
                                    <span
                                        style="display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">20240441@novaims.unl.pt</span>
                                </a>
                                <a href="mailto:20240445@novaims.unl.pt"
                                    style="color: #ffffff; text-decoration: none; padding: 8px 10px; background-color: #e74c3c; border-radius: 4px; transition: all 0.3s ease; display: block; font-size: 13px; border: 1px solid #e74c3c;">
                                    <span
                                        style="display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">20240445@novaims.unl.pt</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Copyright section -->
                    <div class="copyright"
                        style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e74c3c; font-size: 13px; color: #ffffff; text-align: center;">
                        &copy; 2024 Culinaviz <span
                            style="display: inline-block; margin: 0 10px; font-size: 16px; color: #e74c3c;">‚Ä¢</span>
                        Group 7 <span
                            style="display: inline-block; margin: 0 10px; font-size: 16px; color: #e74c3c;">‚Ä¢</span>
                        Data Visualization
                    </div>
                </div>
            </footer>
        </main>
    </div>
    <!-- Include JavaScript resources -->
    <script src="js/jquery.1.8.3.min.js">
    </script>
    <script src="js/wow.min.js">
    </script>
    <script src="js/featherlight.min.js">
    </script>
    <script src="js/featherlight.gallery.min.js">
    </script>
    <script src="js/jquery.enllax.min.js">
    </script>
    <script src="js/jquery.scrollUp.min.js">
    </script>
    <script src="js/jquery.easing.min.js">
    </script>
    <script src="js/jquery.stickyNavbar.min.js">
    </script>
    <script src="js/jquery.waypoints.min.js">
    </script>
    <script src="js/images-loaded.min.js">
    </script>
    <script src="js/lightbox.min.js">
    </script>
    <script src="js/site.js">
    </script>
    <script src="https://d3js.org/d3.v6.min.js"></script>

    <!-- Fix for section navigation -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize tooltip logic early
            const tooltipMap = document.getElementById("tooltip-map");

            // Helper function to show and position tooltip
            window.showTooltip = function (event, content) {
                if (tooltipMap) {
                    tooltipMap.innerHTML = content;
                    tooltipMap.style.opacity = "1";
                    tooltipMap.style.transform = "scale(1)";
                    tooltipMap.style.display = "block";
                    tooltipMap.style.left = (event.pageX + 15) + "px";
                    tooltipMap.style.top = (event.pageY - 15) + "px";
                    console.log("Tooltip displayed at:", event.pageX, event.pageY);
                } else {
                    console.error("Tooltip element not found");
                }
            };

            // Helper function to hide tooltip
            window.hideTooltip = function () {
                if (tooltipMap) {
                    tooltipMap.style.opacity = "0";
                    tooltipMap.style.transform = "scale(0.95)";
                    tooltipMap.style.display = "none";
                }
            };

            // Fix for the Cuisine Connections section navigation
            const cuisineConnectionsLinks = document.querySelectorAll('a[href="#radial-chart-section"]');
            cuisineConnectionsLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const radialSection = document.getElementById('radial-chart-section');
                    if (radialSection) {
                        radialSection.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // Fix for all section navigation for consistency
            const allSectionLinks = document.querySelectorAll('nav a[href^="#"]');
            allSectionLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        }); // Esta chave fecha o document.addEventListener
    </script>

    <!-- Include the fix-maps.js script to handle tooltips more reliably -->
    <script src="fix-maps.js"></script>

    <!-- Nova biblioteca D3.js vers√£o 7 e topojson -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>

    <!-- Script de corre√ß√£o do mapa -->
    <!-- <script src="restaurant-map-fix.js"></script> -->
</body>

</html>